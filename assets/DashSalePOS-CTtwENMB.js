const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FlexSpace-b1mouiw-.js","assets/index-B0yHIKUr.js","assets/index-DI_XrWgU.css","assets/SVG-C1QIvnp-.js","assets/ShowQRProducts-BpT8ELXB.js","assets/ShowQRPrintLabel-ChDDt9QQ.js","assets/fontkit.es-B-YAzz2J.js","assets/qrcode-DHy8FFhS.js","assets/InitPrintServices-By8lCubt.js","assets/Toast-7ZjRvaI-.js","assets/Toast-DLpFKn-Q.css","assets/InputHr-C3z8yRI8.js","assets/InputHr-BXFw4d2l.css","assets/LoadingColorSpinner-Rr7MPnOz.js","assets/LoadingColorSpinner-DPNLfwBi.css","assets/ButonHrm-B7pqqULO.js","assets/ButonHrm-BSeWNUGQ.css","assets/ItemOnSalesPos-C-lzyy34.js","assets/components-BwTu2_dl.js"])))=>i.map(i=>d[i]);
import{l as E,_ as q,aF as I,c as H,a as V,o as le,b as se,d as G,i as f,e as h,O,F as Y,S as Q,D as ce,f as K,z as J,m as U,n as R,p as M,U as ne,M as oe,r as de,t as A,v as P,x as ue,w as me,y as pe}from"./index-B0yHIKUr.js";import{OpenModal as fe,CloseModal as _e}from"./DialogHRM-CMtiwDEl.js";import"./browser-image-compression-BVJ4p9S0.js";import{OpenToast as D}from"./Toast-7ZjRvaI-.js";import"./fontkit.es-B-YAzz2J.js";import"./qrcode-DHy8FFhS.js";import{g as te,a as re}from"./handelImagesServices-BiRvQM6l.js";import{LookupInventory as W}from"./DashInventoryMov-Cld-_Vek.js";import{EditInput as he}from"./SalesDetails-DjO2jtKS.js";import"./DashInventory-CVO5f4sT.js";import"./AddInventory-CG8G33dn.js";import"./debounces-BRDRkBxW.js";import"./DashProducts-Bg601beM.js";import"./App.module-CbHnVtRQ.js";import"./FlexSpace-b1mouiw-.js";import"./print_invoice_service-DKtSGBcC.js";import"./InitPrintServices-By8lCubt.js";E(()=>q(()=>import("./FlexSpace-b1mouiw-.js"),__vite__mapDeps([0,1,2])));E(()=>q(()=>import("./SVG-C1QIvnp-.js"),__vite__mapDeps([3,1,2])));E(()=>q(()=>import("./ShowQRProducts-BpT8ELXB.js"),__vite__mapDeps([4,1,2,5,6,7,8,9,10])));E(()=>q(()=>import("./InputHr-C3z8yRI8.js"),__vite__mapDeps([11,1,2,12])));const L=e=>new Promise((a,d)=>{I.get(e,function(c,i){a(i)})});var ge=A('<div style="padding:50px 0"><section class=qsuVSc><section class=bLl6je><section class=dvPdhb>'),be=A('<section class="h6rxkc ">'),ye=A('<section class=KgyCAd><section class=WirBi><section class=""><section class="EMijzc centerBx"><div class="icon_status centerBx "style="margin:0 4px"></div><div class="icon_status centerBx "style="margin:0 4px">'),ve=A('<section class=rtS8wf><div class=X3QHFf><div class="LhAUHc evth2b"><div class=kDdWge><div class=QCNFEe><p class=jhB0af>Summario de la orden</p></div><div class=qntUl><p class=B7xUP><span data-test-integ-cart-subtotal-label="">Subtotal</span><span data-test-integ-cart-subtotal-value="">$</span></p><p class=B7xUP><span data-test-integ-cart-subtotal-label="">Estimated tax</span><span data-test-integ-cart-subtotal-value="">$</span></p><p class=B7xUP><span data-test-integ-cart-subtotal-label=""class=OGw7rb>Estimated total</span><span data-test-integ-cart-subtotal-value=""class=OGw7rb> $</span></p></div></div><section class=JM2zDb>'),$e=A('<section class=kGEQJf><section class=Z722Ge><section class=VcJUVb><section class=h7Oog><span class=YdB1ac><img class=bwpkad alt=sf></span><section class=pFJUxe><section class=wDj5sf><span data-line-number=1><span class=XNnpOb href=#> </span></span></section><section class=DHk3Fe><section class=Jm2qx><span aria-hidden=true>Qty:</span><select class=RIw0b aria-label="Product Quantity"></select></section><p class=GehUpe data-test-line-item-price=""></p><section class=dEfaq><section class=JpKBkb><button class=yjHiqb><span>Remover'),Ce=A("<option selected>"),xe=A("<option>"),Pe=A('<div><div class=QCNFEe><p class=jhB0af>Confirmar Orden</p></div><p class=B7xUP><span data-test-integ-cart-subtotal-label="">Desea completar la orden y actualizar el inventario</span></p><div class=separator></div><div style=margin:15px class=" spaceAround centerBx">'),Se=A('<section class=kGEQJf><section class=Z722Ge><section class=VcJUVb><section class=h7Oog><span class=YdB1ac><img class=bwpkad alt=sf></span><section class=pFJUxe><section class=wDj5sf><span data-line-number=1><span class=XNnpOb href=#> </span></span></section><section class=DHk3Fe><section class=Jm2qx></section><p class=GehUpe data-test-line-item-price=""><span data-test-integ-cart-current-price="">$</span></p><section class=dEfaq><section class=JpKBkb><button class=yjHiqb jsaction=click:IY6UFe data-line-number=1 data-test-remove-btn=1 aria-label="Remove Nest Doorbell (wired, 2nd gen) (Snow) from cart"><span>Remove');const we=E(()=>q(()=>import("./FlexSpace-b1mouiw-.js"),__vite__mapDeps([0,1,2]))),ee=E(()=>q(()=>import("./SVG-C1QIvnp-.js"),__vite__mapDeps([3,1,2])));E(()=>q(()=>import("./LoadingColorSpinner-Rr7MPnOz.js"),__vite__mapDeps([13,1,2,14])));const Ie=E(()=>q(()=>import("./InputHr-C3z8yRI8.js"),__vite__mapDeps([11,1,2,12]))),X=E(()=>q(()=>import("./ButonHrm-B7pqqULO.js"),__vite__mapDeps([15,1,2,3,16])));E(()=>q(()=>import("./ItemOnSalesPos-C-lzyy34.js"),__vite__mapDeps([17,1,2,9,10,18])));const[T,B]=H({items:{}}),k="348723orh2idsffs";function Xe(){V(0),V(0);const[e,a]=V("");le(()=>{}),se(()=>{}),G(()=>{d()});const d=async()=>{(await De())?.map(c=>{B("items",c.doc)})};return(()=>{var u=ge(),c=u.firstChild,i=c.firstChild,_=i.firstChild;return f(_,h(Q,{get when(){return O(T?.items?.cart)},get children(){return h(Y,{get each(){return O(T?.items?.cart)},children:(g,v)=>h(qe,{get itm(){return T?.items?.cart?.[g]}})})}})),f(c,h(ke,{updSearch:a}),null),f(c,h(Ee,{get item(){return T?.items?.cart}}),null),u})()}const ke=e=>{const[a,d]=V(""),[u,c]=V(1),i=()=>{u()===1&&a().length>8&&_(a())},_=async l=>{U?.profile?.agencyStore?.id;let m=`${l}`,o=await N(m),t=O(o)?.[0],r=`${t}`,b=await W(r),p=0,s=0;O(b)?.map(S=>{b[S]?.products?.map(x=>{t===x?.product?.id&&(p+=x?.price*1*x?.qty*1,s+=x?.qty*1)})});let y=1,C=await L(k)||{};C?.cart?.[t]&&(y=C?.cart?.[t].qty*1+1);const F=s?p/s:0;if(o?.[t]?.salePrice||D({text:"Sin precio de venta",timeout:3500,theme:"red",id:P()}),s&&s-y>=0){let S=C;if(C?.cart||(S.cart={},S._id=k),C?.cart?.[t])S.cart[t].qty=y;else{let x={product:{id:t,label:o?.[t]?.name,code:o?.[t]?.code},qty:y,price:F,salePrice:o?.[t]?.salePrice};S.cart[t]=x}I.put(S,function(j,Z){}),B("items",S),d(""),D({text:o?.[t]?.name+" agregado al carrito",timeout:3500,theme:"blue",id:P()})}else D({text:"Sin Existencia",timeout:3500,theme:"red",id:P()})},[g,{refetch:v}]=ce(a,async l=>{if(u()===2&&l.length>4){const m=await N(l);let o=[];return O(m).map(t=>{let r=m[t];o.push(r)}),o}else return[]}),n=()=>{d(""),c(1)};return(()=>{var l=ye(),m=l.firstChild,o=m.firstChild,t=o.firstChild,r=t.firstChild,b=r.nextSibling;return f(o,h(Q,{get when(){return g()?.length>0},get children(){var p=be();return f(p,h(Y,{get each(){return g()},children:(s,y)=>h(Ue,{itm:s,clearTx:n})})),p}}),t),f(t,h(Ie,{width:"260px",backColor:"#ffffff",borderColor:"#b2b2b2",borderActiveColor:"var(--background-red-ssg)",get value(){return a()},placeholder:"buscar productos ...",colors:"#2b2b2b",handleClick:d,onEnter:i}),r),r.$$click=()=>c(1),f(r,h(ee,{name:"qrcode-scan",size:22,get color(){return u()===1?"#646cff":""}})),b.$$click=()=>c(2),f(b,h(ee,{name:"keyboard",size:22,get color(){return u()===2?"#646cff":""}})),l})()},Ee=e=>{const a=c=>{let i=0;return O(e?.item)?.map(_=>{let g=e?.item?.[_];i+=g?.qty*1*g?.salePrice}),i},d=async c=>{let i=new Date,_=P(),g=me(T?.items?.cart),v=[];O(g).map(p=>{let s={...g[p]};s.qty=s.qty*-1,v.push(s)});let n={type:"SALES",invoice:i.getFullYear()+pe(12),description:"",store:U?.profile?.agencyStore?.id,hbl:"",products:v,ssg_inventory_key:_,ssg_sorder_key:_,createDate:i.getTime(),isCompleted:!0,businessId:U?.profile?.businessYId},l={params:{businessId:U?.profile?.businessYId},form:n},m=R(139003),o={...l,...m},t=R(431005),r={...l,...t};if(await M(o),!(await M(r))?.error){_e(c);let s=await L(k);s.cart=void 0,I.put(s,function(C,F){}),B("items",s)}},u=()=>{let c=P(),i={};i.id=c,i.props={minHeight:"1vh",overlay:!0,height:"93vh",zIndex:450},i.content=h(Ae,{modalId:c,completeOrder:()=>d(c)}),fe(i)};return(()=>{var c=ve(),i=c.firstChild,_=i.firstChild,g=_.firstChild,v=g.firstChild,n=v.nextSibling,l=n.firstChild,m=l.firstChild,o=m.nextSibling;o.firstChild;var t=l.nextSibling,r=t.firstChild,b=r.nextSibling;b.firstChild;var p=t.nextSibling,s=p.firstChild,y=s.nextSibling;y.firstChild;var C=g.nextSibling;return f(o,()=>a().toFixed(2),null),f(b,()=>(a()*.06).toFixed(2),null),f(y,()=>(a()*.06+a()).toFixed(2),null),f(C,h(Q,{get when(){return a()>0},get children(){return h(X,{color:"#646cff",label:"Enviar Orden",icon:"outline_cart",handleClick:u})}})),c})()},qe=e=>{const[a,d]=H(),u=()=>a?.[e?.itm?.product?.id]?.productImageUrl?te()+re()+"/"+a?.[e?.itm?.product?.id]?.productImageUrl:null,c=async()=>{let n=e?.itm?.product?.id,l=`${n}`,m=await N(l);m?.[n]?.productImageUrl&&d(n,m?.[n])};G(()=>{c()});let i=Array.from(Array(10).keys());const _=async n=>{U?.profile?.agencyStore?.id;let l=e?.itm?.product?.id,m=`${l}`,o=await W(m),t=0,r=0;O(o)?.map(p=>{o[p]?.products?.map(s=>{l===s?.product?.id&&(t+=s?.price*1*s?.qty*1,r+=s?.qty*1)})});const b=r?t/r:0;if(e?.itm?.salePrice||D({text:"Sin precio de venta",timeout:3500,theme:"red",id:P()}),r&&r-n>=0){let p=await L(k)||{},s=p;if(p?.cart||(s.cart={},s._id=k),p?.cart?.[l])s.cart[l].qty=n;else{let y={product:{id:l,label:e?.itm?.name,code:e?.itm?.code},qty:n,price:b,salePrice:e?.itm?.salePrice};s.cart[l]=y}I.put(s,function(C,F){}),B("items",s),D({text:" El carrito fue actualizado",timeout:3500,theme:"blue",id:P()})}else console.log(e?.itm?.qty),D({text:"Sin Existencia",timeout:3500,theme:"red",id:P()})},g=()=>{I.get(k,function(l,m){let o={...m};delete o.cart[e?.itm?.product?.id],I.put(o,function(r,b){r||B("items","cart",e?.itm?.product?.id,void 0)})})},v=(n,l)=>{I.get(k,function(o,t){let r={...t};r.cart[e?.itm?.product?.id][n]=l,I.put(r,function(p,s){p||B("items","cart",e?.itm?.product?.id,n,l)})})};return(()=>{var n=$e(),l=n.firstChild,m=l.firstChild,o=m.firstChild,t=o.firstChild,r=t.firstChild,b=t.nextSibling,p=b.firstChild,s=p.firstChild,y=s.firstChild;y.firstChild;var C=p.nextSibling,F=C.firstChild,S=F.firstChild,x=S.nextSibling,j=F.nextSibling,Z=j.nextSibling,ie=Z.firstChild,ae=ie.firstChild;return f(y,()=>e?.itm?.product?.label,null),x.addEventListener("change",$=>{_($?.target?.value)}),f(x,h(Y,{each:i,children:($,z)=>h(Q,{get when(){return $*1+1===e?.itm?.qty*1},get fallback(){return(()=>{var w=xe();return w.value=$*1+1+"",f(w,$*1+1),w})()},get children(){var w=Ce();return w.value=$*1+1+"",f(w,$*1+1),w}})})),f(j,h(he,{value:"",get label(){return`${(e?.itm?.salePrice*1).toFixed(2)}`},key:"salePrice",updItem:v,width:"600px"})),ae.$$click=g,K($=>{var z=u(),w=e?.itm?.qty;return z!==$.e&&J(r,"src",$.e=z),w!==$.t&&J(x,"aria-value",$.t=w),$},{e:void 0,t:void 0}),n})()},N=async(e,a)=>{let d={params:{businessId:U?.profile?.businessYId}};e&&e.split(" ").map((i,_)=>{i&&(d.params[":search"+_]=i.trim())});let u=R(122001);d={...d,...u},d.params[":search0"];const c=await M(d);return c?.error?{}:c},Ze=async e=>{let a=[];e.map(d=>{let u={params:{id:d?.ssg_track_key,idairguide:"all"}},c=R(802002);u={...u,...c},a.push(u)}),ne(a,Oe)},Oe=async e=>{const d=await oe(e);if(d)return d},De=()=>new Promise((e,a)=>{I.allDocs({include_docs:!0,descending:!0},function(d,u){e(u.rows)})});function Ae(e){return(()=>{var a=Pe(),d=a.firstChild,u=d.nextSibling,c=u.nextSibling,i=c.nextSibling;return a.style.setProperty("max-height","80vh"),a.style.setProperty("overflow","auto"),a.style.setProperty("background","#fff"),a.style.setProperty("border-radius","11px"),a.style.setProperty("padding"," 0 21px"),f(i,h(we,{}),null),f(i,h(X,{color:"#646cff",icon:"send",label:"Completar Orden",get handleClick(){return e.completeOrder}}),null),K(_=>(_=ue()?"96vw":"420px")!=null?a.style.setProperty("width",_):a.style.removeProperty("width")),a})()}const Ue=e=>{const[a,d]=H(),u=()=>a?.prod?.productImageUrl?te()+re()+"/"+a?.prod?.productImageUrl:null;G(()=>{d("prod",e?.itm)}),Array.from(Array(10).keys());const c=async()=>{let i=a?.prod?.ssg_product_key;U?.profile?.agencyStore?.id;let _=`${i} `,g=await W(_),v=0,n=0;O(g)?.map(t=>{g[t]?.products?.map(r=>{i===r?.product?.id&&(v+=r?.price*1*r?.qty*1,n+=r?.qty*1)})});let l=1,m=await L(k)||{};m?.cart?.[i]&&(l=m?.cart?.[i].qty+1);const o=n?v/n:0;if(e?.itm?.salePrice||D({text:"Sin precio de venta",timeout:3500,theme:"red",id:P()}),n&&n-l>=0){let t=await L(k)||{},r=t;if(t?.cart||(r.cart={},r._id=k),t?.cart?.[i])r.cart[i].qty=l;else{let b={product:{id:i,label:e?.itm?.name,code:e?.itm?.code},qty:l,price:o,salePrice:e?.itm?.salePrice};r.cart[i]=b}I.put(r,function(p,s){}),B("items",r),e?.clearTx(),D({text:" El carrito fue actualizado",timeout:3500,theme:"blue",id:P()})}else D({text:"Sin Existencia",timeout:3500,theme:"red",id:P()})};return h(Q,{get when(){return e?.itm?.salePrice},get children(){var i=Se(),_=i.firstChild,g=_.firstChild,v=g.firstChild,n=v.firstChild,l=n.firstChild,m=n.nextSibling,o=m.firstChild,t=o.firstChild,r=t.firstChild;r.firstChild;var b=o.nextSibling,p=b.firstChild,s=p.nextSibling,y=s.firstChild;return y.firstChild,f(r,()=>e?.itm?.name,null),f(p,h(X,{color:"#646cff",label:"Agregar",handleClick:c})),f(y,()=>(e?.itm?.salePrice*1).toFixed(2),null),K(()=>J(l,"src",u())),i}})};de(["click"]);export{N as LookupProducts,T as cartItems,k as cartKey,Xe as default,Oe as fetchCSVInve,De as loadCarts,Ze as loadProduct,B as setCartItems};
