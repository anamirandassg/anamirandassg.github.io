const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FlexSpace-NZkrCwAj.js","assets/index-DQRb1HKE.js","assets/index-B8bAFC38.css","assets/SVG-iOfYDQCO.js","assets/ShowQRProducts-BsRGYAno.js","assets/ShowQRPrintLabel-Ccw90ZC5.js","assets/fontkit.es-BRZXK7Sr.js","assets/qrcode-DHy8FFhS.js","assets/InitPrintServices-Dganc0kS.js","assets/Toast-Cx4UPE1S.js","assets/Toast-DLpFKn-Q.css","assets/InputHr-B1_kHGIE.js","assets/InputHr-BXFw4d2l.css","assets/LoadingColorSpinner-QBKJnVqo.js","assets/LoadingColorSpinner-DPNLfwBi.css","assets/ButonHrm-XM3Pkuij.js","assets/ButonHrm-BSeWNUGQ.css","assets/ItemOnSalesPos-DmzjZLXY.js","assets/components-D-gQ5i5n.js"])))=>i.map(i=>d[i]);
import{l as w,_ as I,aF as D,c as H,a as L,o as it,b as st,d as G,i as h,e as g,O as E,F as Y,S as R,D as ct,p as K,x as M,j as U,k as j,m as N,U as nt,M as ot,A as dt,t as O,q as A,v as ut,r as pt,w as mt}from"./index-DQRb1HKE.js";import{OpenModal as ft,CloseModal as _t}from"./DialogHRM-CPSHIKoS.js";import"./browser-image-compression-BVJ4p9S0.js";import{OpenToast as B}from"./Toast-Cx4UPE1S.js";import"./fontkit.es-BRZXK7Sr.js";import"./qrcode-DHy8FFhS.js";import{g as rt,a as at}from"./handelImagesServices-CrOjBgp_.js";import{LookupInventory as W}from"./DashInventoryMov-CvH5o1b3.js";import"./DashInventory-BYnAZ9nS.js";import"./AddInventory-CU0tgFO6.js";import"./debounces-D-VgCguP.js";import"./DashProducts-C8DQaGYc.js";import"./App.module-CbHnVtRQ.js";import"./FlexSpace-NZkrCwAj.js";w(()=>I(()=>import("./FlexSpace-NZkrCwAj.js"),__vite__mapDeps([0,1,2])));w(()=>I(()=>import("./SVG-iOfYDQCO.js"),__vite__mapDeps([3,1,2])));w(()=>I(()=>import("./ShowQRProducts-BsRGYAno.js"),__vite__mapDeps([4,1,2,5,6,7,8,9,10])));w(()=>I(()=>import("./InputHr-B1_kHGIE.js"),__vite__mapDeps([11,1,2,12])));const Q=t=>new Promise((r,d)=>{D.get(t,function(s,l){r(l)})});var ht=O('<div style="padding:50px 0"><section class=qsuVSc><section class=bLl6je><section class=dvPdhb>'),gt=O('<section class="h6rxkc ">'),bt=O('<section class=KgyCAd><section class=WirBi><section class=""><section class="EMijzc centerBx"><div class="icon_status centerBx "style="margin:0 4px"></div><div class="icon_status centerBx "style="margin:0 4px">'),yt=O('<section class=rtS8wf><div class=X3QHFf><div class="LhAUHc evth2b"><div class=kDdWge><div class=QCNFEe><p class=jhB0af>Summario de la orden</p></div><div class=qntUl><p class=B7xUP><span data-test-integ-cart-subtotal-label="">Subtotal</span><span data-test-integ-cart-subtotal-value="">$</span></p><p class=B7xUP><span data-test-integ-cart-subtotal-label="">Estimated tax</span><span data-test-integ-cart-subtotal-value="">$</span></p><p class=B7xUP><span data-test-integ-cart-subtotal-label=""class=OGw7rb>Estimated total</span><span data-test-integ-cart-subtotal-value=""class=OGw7rb> $</span></p></div></div><section class=JM2zDb>'),$t=O('<section class=kGEQJf><section class=Z722Ge><section class=VcJUVb><section class=h7Oog><span class=YdB1ac><img class=bwpkad alt=sf></span><section class=pFJUxe><section class=wDj5sf><span data-line-number=1><span class=XNnpOb href=#> </span></span></section><section class=DHk3Fe><section class=Jm2qx><span aria-hidden=true>Qty:</span><select class=RIw0b aria-label="Product Quantity"></select></section><p class=GehUpe data-test-line-item-price=""><span data-test-integ-cart-current-price="">$</span></p><section class=dEfaq><section class=JpKBkb><button class=yjHiqb><span>Remover'),vt=O("<option selected>"),Ct=O("<option>"),xt=O('<div><div class=QCNFEe><p class=jhB0af>Confirmar Orden</p></div><p class=B7xUP><span data-test-integ-cart-subtotal-label="">Desea completar la orden y actualizar el inventario</span></p><div class=separator></div><div style=margin:15px class=" spaceAround centerBx">'),St=O('<section class=kGEQJf><section class=Z722Ge><section class=VcJUVb><section class=h7Oog><span class=YdB1ac><img class=bwpkad alt=sf></span><section class=pFJUxe><section class=wDj5sf><span data-line-number=1><span class=XNnpOb href=#> </span></span></section><section class=DHk3Fe><section class=Jm2qx></section><p class=GehUpe data-test-line-item-price=""><span data-test-integ-cart-current-price="">$</span></p><section class=dEfaq><section class=JpKBkb><button class=yjHiqb jsaction=click:IY6UFe data-line-number=1 data-test-remove-btn=1 aria-label="Remove Nest Doorbell (wired, 2nd gen) (Snow) from cart"><span>Remove');const Pt=w(()=>I(()=>import("./FlexSpace-NZkrCwAj.js"),__vite__mapDeps([0,1,2]))),et=w(()=>I(()=>import("./SVG-iOfYDQCO.js"),__vite__mapDeps([3,1,2])));w(()=>I(()=>import("./LoadingColorSpinner-QBKJnVqo.js"),__vite__mapDeps([13,1,2,14])));const wt=w(()=>I(()=>import("./InputHr-B1_kHGIE.js"),__vite__mapDeps([11,1,2,12]))),X=w(()=>I(()=>import("./ButonHrm-XM3Pkuij.js"),__vite__mapDeps([15,1,2,3,16])));w(()=>I(()=>import("./ItemOnSalesPos-DmzjZLXY.js"),__vite__mapDeps([17,1,2,9,10,18])));const[V,F]=H({items:{}}),q="348723orh2idsffs";function Gt(){L(0),L(0);const[t,r]=L("");it(()=>{}),st(()=>{}),G(()=>{d()});const d=async()=>{(await Ot())?.map(s=>{F("items",s.doc)})};return(()=>{var u=ht(),s=u.firstChild,l=s.firstChild,c=l.firstChild;return h(c,g(R,{get when(){return E(V?.items?.cart)},get children(){return g(Y,{get each(){return E(V?.items?.cart)},children:(b,p)=>g(Et,{get itm(){return V?.items?.cart?.[b]}})})}})),h(s,g(It,{updSearch:r}),null),h(s,g(kt,{get item(){return V?.items?.cart}}),null),u})()}const It=t=>{const[r,d]=L(""),[u,s]=L(1),l=()=>{u()===1&&r().length>8&&c(r())},c=async a=>{let f=U?.profile?.agencyStore?.id,m=`${a}`,n=await z(m),e=E(n)?.[0],o=`${e} ${f}`,_=await W(o),i=0,y=0;E(_)?.map(x=>{_[x]?.products?.map(S=>{e===S?.product?.id&&(i+=S?.price*1*S?.qty*1,y+=S?.qty*1)})});let C=1,k=await Q(q)||{};k?.cart?.[e]&&(C=k?.cart?.[e].qty*1+1);const T=y?i/y:0;if(y&&y-C>=0){let x=k;if(k?.cart||(x.cart={},x._id=q),k?.cart?.[e])x.cart[e].qty=C;else{let S={product:{id:e,label:n?.[e]?.name,code:n?.[e]?.code},qty:C,price:T,salePrice:n?.[e]?.salePrice};x.cart[e]=S}D.put(x,function(Z,tt){}),F("items",x),d(""),B({text:n?.[e]?.name+" agregado al carrito",timeout:3500,theme:"blue",id:A()})}else B({text:"Sin Existencia",timeout:3500,theme:"red",id:A()})},[b,{refetch:p}]=ct(r,async a=>{if(u()===2&&a.length>4){const f=await z(a);let m=[];return E(f).map(n=>{let e=f[n];m.push(e)}),m}else return[]}),$=()=>{d(""),s(1)};return(()=>{var a=bt(),f=a.firstChild,m=f.firstChild,n=m.firstChild,e=n.firstChild,o=e.nextSibling;return h(m,g(R,{get when(){return b()?.length>0},get children(){var _=gt();return h(_,g(Y,{get each(){return b()},children:(i,y)=>g(At,{itm:i,clearTx:$})})),_}}),n),h(n,g(wt,{width:"260px",backColor:"#ffffff",borderColor:"#b2b2b2",borderActiveColor:"var(--background-red-ssg)",get value(){return r()},placeholder:"buscar productos ...",colors:"#2b2b2b",handleClick:d,onEnter:l}),e),e.$$click=()=>s(1),h(e,g(et,{name:"qrcode-scan",size:22,get color(){return u()===1?"#646cff":""}})),o.$$click=()=>s(2),h(o,g(et,{name:"keyboard",size:22,get color(){return u()===2?"#646cff":""}})),a})()},kt=t=>{const r=s=>{let l=0;return E(t?.item)?.map(c=>{let b=t?.item?.[c];l+=b?.qty*1*b?.salePrice}),l},d=async s=>{let l=new Date,c=A(),b=pt(V?.items?.cart),p=[];E(b).map(_=>{let i={...b[_]};i.qty=i.qty*-1,p.push(i)});let $={type:"SALES",invoice:l.getFullYear()+mt(12),description:"",store:U?.profile?.agencyStore?.id,hbl:"",products:p,ssg_inventory_key:c,ssg_sorder_key:c,createDate:l.getTime(),isCompleted:!0,businessId:U?.profile?.businessYId},a={params:{businessId:U?.profile?.businessYId},form:$},f=j(139003),m={...a,...f},n=j(431005),e={...a,...n};if(await N(m),!(await N(e))?.error){_t(s);let i=await Q(q);i.cart=void 0,D.put(i,function(C,k){}),F("items",i)}},u=()=>{let s=A(),l={};l.id=s,l.props={minHeight:"1vh",overlay:!0,height:"93vh",zIndex:450},l.content=g(Dt,{modalId:s,completeOrder:()=>d(s)}),ft(l)};return(()=>{var s=yt(),l=s.firstChild,c=l.firstChild,b=c.firstChild,p=b.firstChild,$=p.nextSibling,a=$.firstChild,f=a.firstChild,m=f.nextSibling;m.firstChild;var n=a.nextSibling,e=n.firstChild,o=e.nextSibling;o.firstChild;var _=n.nextSibling,i=_.firstChild,y=i.nextSibling;y.firstChild;var C=b.nextSibling;return h(m,()=>r().toFixed(2),null),h(o,()=>(r()*.06).toFixed(2),null),h(y,()=>(r()*.06+r()).toFixed(2),null),h(C,g(R,{get when(){return r()>0},get children(){return g(X,{color:"#646cff",label:"Enviar Orden",icon:"outline_cart",handleClick:u})}})),s})()},Et=t=>{const[r,d]=H(),u=()=>r?.[t?.itm?.product?.id]?.productImageUrl?rt()+at()+"/"+r?.[t?.itm?.product?.id]?.productImageUrl:null,s=async()=>{let p=t?.itm?.product?.id,$=`${p}`,a=await z($);a?.[p]?.productImageUrl&&d(p,a?.[p])};G(()=>{s()});let l=Array.from(Array(10).keys());const c=async p=>{let $=U?.profile?.agencyStore?.id,a=t?.itm?.product?.id,f=`${a} ${$}`,m=await W(f),n=0,e=0;E(m)?.map(_=>{m[_]?.products?.map(i=>{a===i?.product?.id&&(n+=i?.price*1*i?.qty*1,e+=i?.qty*1)})});const o=e?n/e:0;if(e&&e-p>=0){let _=await Q(q)||{},i=_;if(_?.cart||(i.cart={},i._id=q),_?.cart?.[a])i.cart[a].qty=p;else{let y={product:{id:a,label:t?.itm?.name,code:t?.itm?.code},qty:p,price:o,salePrice:t?.itm?.salePrice};i.cart[a]=y}D.put(i,function(C,k){}),F("items",i),B({text:" El carrito fue actualizado",timeout:3500,theme:"blue",id:A()})}else console.log(t?.itm?.qty),B({text:"Sin Existencia",timeout:3500,theme:"red",id:A()})},b=()=>{D.get(q,function($,a){let f={...a};delete f.cart[t?.itm?.product?.id],D.put(f,function(n,e){n||F("items","cart",t?.itm?.product?.id,void 0)})})};return(()=>{var p=$t(),$=p.firstChild,a=$.firstChild,f=a.firstChild,m=f.firstChild,n=m.firstChild,e=m.nextSibling,o=e.firstChild,_=o.firstChild,i=_.firstChild;i.firstChild;var y=o.nextSibling,C=y.firstChild,k=C.firstChild,T=k.nextSibling,x=C.nextSibling,S=x.firstChild;S.firstChild;var Z=x.nextSibling,tt=Z.firstChild,lt=tt.firstChild;return h(i,()=>t?.itm?.product?.label,null),T.addEventListener("change",v=>{c(v?.target?.value)}),h(T,g(Y,{each:l,children:(v,J)=>g(R,{get when(){return v*1+1===t?.itm?.qty*1},get fallback(){return(()=>{var P=Ct();return P.value=v*1+1+"",h(P,v*1+1),P})()},get children(){var P=vt();return P.value=v*1+1+"",h(P,v*1+1),P}})})),h(S,()=>(t?.itm?.salePrice*1).toFixed(2),null),lt.$$click=b,K(v=>{var J=u(),P=t?.itm?.qty;return J!==v.e&&M(n,"src",v.e=J),P!==v.t&&M(T,"aria-value",v.t=P),v},{e:void 0,t:void 0}),p})()},z=async(t,r)=>{let d={params:{businessId:U?.profile?.businessYId}};t&&t.split(" ").map((l,c)=>{l&&(d.params[":search"+c]=l.trim())});let u=j(122001);d={...d,...u},d.params[":search0"];const s=await N(d);return s?.error?{}:s},Yt=async t=>{let r=[];t.map(d=>{let u={params:{id:d?.ssg_track_key,idairguide:"all"}},s=j(802002);u={...u,...s},r.push(u)}),nt(r,qt)},qt=async t=>{const d=await ot(t);if(d)return d},Ot=()=>new Promise((t,r)=>{D.allDocs({include_docs:!0,descending:!0},function(d,u){t(u.rows)})});function Dt(t){return(()=>{var r=xt(),d=r.firstChild,u=d.nextSibling,s=u.nextSibling,l=s.nextSibling;return r.style.setProperty("max-height","80vh"),r.style.setProperty("overflow","auto"),r.style.setProperty("background","#fff"),r.style.setProperty("border-radius","11px"),r.style.setProperty("padding"," 0 21px"),h(l,g(Pt,{}),null),h(l,g(X,{color:"#646cff",icon:"send",label:"Completar Orden",get handleClick(){return t.completeOrder}}),null),K(c=>(c=ut()?"96vw":"420px")!=null?r.style.setProperty("width",c):r.style.removeProperty("width")),r})()}const At=t=>{const[r,d]=H(),u=()=>r?.prod?.productImageUrl?rt()+at()+"/"+r?.prod?.productImageUrl:null;G(()=>{d("prod",t?.itm)}),Array.from(Array(10).keys());const s=async()=>{let l=U?.profile?.agencyStore?.id,c=r?.prod?.ssg_product_key,b=`${c} ${l}`,p=await W(b),$=0,a=0;E(p)?.map(e=>{p[e]?.products?.map(o=>{c===o?.product?.id&&($+=o?.price*1*o?.qty*1,a+=o?.qty*1)})});let f=1,m=await Q(q)||{};m?.cart?.[c]&&(f=m?.cart?.[c].qty+1);const n=a?$/a:0;if(a&&a-f>=0){let e=await Q(q)||{},o=e;if(e?.cart||(o.cart={},o._id=q),e?.cart?.[c])o.cart[c].qty=f;else{let _={product:{id:c,label:t?.itm?.name,code:t?.itm?.code},qty:f,price:n,salePrice:t?.itm?.salePrice};o.cart[c]=_}D.put(o,function(i,y){}),F("items",o),t?.clearTx(),B({text:" El carrito fue actualizado",timeout:3500,theme:"blue",id:A()})}else B({text:"Sin Existencia",timeout:3500,theme:"red",id:A()})};return g(R,{get when(){return t?.itm?.salePrice},get children(){var l=St(),c=l.firstChild,b=c.firstChild,p=b.firstChild,$=p.firstChild,a=$.firstChild,f=$.nextSibling,m=f.firstChild,n=m.firstChild,e=n.firstChild;e.firstChild;var o=m.nextSibling,_=o.firstChild,i=_.nextSibling,y=i.firstChild;return y.firstChild,h(e,()=>t?.itm?.name,null),h(_,g(X,{color:"#646cff",label:"Agregar",handleClick:s})),h(y,()=>(t?.itm?.salePrice*1).toFixed(2),null),K(()=>M(a,"src",u())),l}})};dt(["click"]);export{z as LookupProducts,V as cartItems,q as cartKey,Gt as default,qt as fetchCSVInve,Ot as loadCarts,Yt as loadProduct,F as setCartItems};
