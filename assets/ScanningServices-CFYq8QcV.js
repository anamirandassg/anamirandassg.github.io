import{OpenToast as o}from"./Toast-DVa0BnZN.js";import{k as A,r as L}from"./index-DfnndQVu.js";import{g as y}from"./globalSignal-B85JDhH1.js";import{g as l,b as u,f as d}from"./Util-uEfv1z7O.js";let b="No se encontro ningun registro o el codigo es incorrecto",q=[400,300,400,300,400],c=[300,80,300,80,300,80,300];const N=e=>{e=e.split("'").join("-");let r=e.split("/");e.split("-").length>3&&(r=e.split("-").join);let t=r?.[0];t.indexOf("2300")===0&&(t="2300"+(t.split("2300")?.[1]).slice(0,5));let a="^[A-Z]{3}[0-9]{4}-[1-9]{5}";const s=new RegExp(a);let i=t.length===13&&s.test(t),g="^[0-9]{4}-[1-9]{4}";const m=new RegExp(g);let p=t.length===9&&m.test(t),v=r.length>4&&t.length===12,S="^Y24[0-9]{6}";const I=new RegExp(S);let f=t.length===9&&I.test(t),w="^SS24[0-9]{6}";const k=new RegExp(w);let x=t.length===10&&k.test(t),C="^[0-9]";const E=new RegExp(C);let R=t.length>6&&t.length<11&&E.test(t);if(i||v||p){let n={idairguide:r?.[0],":search0":r?.[1],":search1":r?.[3]};return i&&(n={idairguide:"175-2383"+t.slice(3,7),":search0":t}),p&&(n={idairguide:"175-2383"+t.slice(0,4),":search0":t}),{params:n,code:1}}else if(R||f||x)return{txt:t,code:1}},F=async(e,r)=>{let t=N(e),a={timeStamp:new Date().getTime(),latitude:y?.latitude,longitude:y?.longitude,statusId:r,userId:A?.profile?.userId};return t?.params?await O(t.params,a):t?.txt?await _(t.txt,a):(navigator.vibrate(c),{error:{alert:"error",scanData:{consigneeInfo:{ybestate:"Codigo Incorrecto"}}}})},O=async(e,r)=>{let t=await Q(e),a=Object.keys(t)?.[0];if(t[a]?.cidentity){let s=h(t[a],r);return navigator.vibrate(500),s}o({text:b,timeout:2500,theme:"red",id:l()}),navigator.vibrate(c)},_=async(e,r)=>{let t=await G(e);if(t?.cidentity){let a=await h(t,r);return navigator.vibrate(500),a}o({text:b,timeout:2500,theme:"red",id:l()}),navigator.vibrate(c)},h=async(e,r)=>{let t=e?.statusHistory||[];if(t.push(r),L?.roles?.[e?.consigneeInfo?.ybestate]?.isActive)if(e?.currentStatus!==r.statusId){let a={statusHistory:t,currentStatus:r.statusId},s={ssg_track_key:e.ssg_track_key,idairguide:e.idairguide},i=await D(s,a),g={tracking:e?.tracking,idairguide:e.idairguide,city:e?.consigneeInfo?.ybcity,estate:e.estate};return{data:{...i,...g}}}else{let a={consigneeInfo:{ybcity:"Fue escaneado",ybestate:e?.consigneeInfo?.ybestate}};return o({text:"FUE ESCANEADO EN "+e?.consigneeInfo?.ybestate,timeout:3500,theme:"orange",id:l()}),navigator.vibrate(q),{error:{alert:"warning",scanData:a}}}else{let a={consigneeInfo:{ybestate:"Zona incorrecta"}};return o({text:"ZONA INCORRECTA",timeout:3500,theme:"orange",id:l()}),navigator.vibrate(c),{error:{alert:"warning",scanData:a}}}},D=async(e,r)=>{let t={params:e,data2update:r},a=u(809004);return t={...t,...a},await d(t)},Q=async e=>{let r={params:e,fldsQry:["idairguide","currentStatus","ssg_track_key","statusHistory","tracking","estate","city","cidentity","consigneeInfo:ybestate","consigneeInfo:ybcity"]},t=u(802001);return r={...r,...t},await d(r)},G=async e=>{let r={params:{id:e}},t=u(803001);return r={...r,...t},await d(r)};export{F as h};
