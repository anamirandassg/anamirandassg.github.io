const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FlexSpace-CFLL4crq.js","assets/index-BVfadb6y.js","assets/index-DI_XrWgU.css","assets/SVG-LCo5ObZa.js","assets/ShowQRProducts-DJoiLwRF.js","assets/ShowQRPrintLabel-CM75kq4x.js","assets/fontkit.es-17Zq-CjM.js","assets/qrcode-DHy8FFhS.js","assets/InitPrintServices-BPaecJE-.js","assets/Toast-C1SPobmY.js","assets/Toast-DLpFKn-Q.css","assets/InputHr-DAw4euwU.js","assets/InputHr-BXFw4d2l.css","assets/LoadingColorSpinner-Bqi6dCjg.js","assets/LoadingColorSpinner-DPNLfwBi.css","assets/ButonHrm-C3-e3Mom.js","assets/ButonHrm-BSeWNUGQ.css","assets/ItemOnSalesPos-DkRGlAAz.js","assets/components-CW83Gmn9.js"])))=>i.map(i=>d[i]);
import{l as I,_ as E,aF as A,c as H,a as T,o as le,b as se,d as G,i as h,e as y,O as k,F as Y,S as L,D as ce,f as K,z as J,m as U,n as R,p as M,U as ne,M as oe,r as de,t as D,v as P,x as ue,w as me,y as pe}from"./index-BVfadb6y.js";import{OpenModal as fe,CloseModal as _e}from"./DialogHRM-DfFAgRQ9.js";import"./browser-image-compression-BVJ4p9S0.js";import{OpenToast as q}from"./Toast-C1SPobmY.js";import"./fontkit.es-17Zq-CjM.js";import"./qrcode-DHy8FFhS.js";import{g as te,a as re}from"./handelImagesServices-sE9KGXuO.js";import{LookupInventory as W}from"./DashInventoryMov-C97mfNPj.js";import"./DashInventory-45zFPSHX.js";import"./AddInventory-C3gfmRz2.js";import"./debounces-CElaE6xx.js";import"./DashProducts-CwOIdxyA.js";import"./App.module-CbHnVtRQ.js";import"./FlexSpace-CFLL4crq.js";I(()=>E(()=>import("./FlexSpace-CFLL4crq.js"),__vite__mapDeps([0,1,2])));I(()=>E(()=>import("./SVG-LCo5ObZa.js"),__vite__mapDeps([3,1,2])));I(()=>E(()=>import("./ShowQRProducts-DJoiLwRF.js"),__vite__mapDeps([4,1,2,5,6,7,8,9,10])));I(()=>E(()=>import("./InputHr-DAw4euwU.js"),__vite__mapDeps([11,1,2,12])));const V=e=>new Promise((i,o)=>{A.get(e,function(l,r){i(r)})});var he=D('<div style="padding:50px 0"><section class=qsuVSc><section class=bLl6je><section class=dvPdhb>'),ge=D('<section class="h6rxkc ">'),be=D('<section class=KgyCAd><section class=WirBi><section class=""><section class="EMijzc centerBx"><div class="icon_status centerBx "style="margin:0 4px"></div><div class="icon_status centerBx "style="margin:0 4px">'),ye=D('<section class=rtS8wf><div class=X3QHFf><div class="LhAUHc evth2b"><div class=kDdWge><div class=QCNFEe><p class=jhB0af>Summario de la orden</p></div><div class=qntUl><p class=B7xUP><span data-test-integ-cart-subtotal-label="">Subtotal</span><span data-test-integ-cart-subtotal-value="">$</span></p><p class=B7xUP><span data-test-integ-cart-subtotal-label="">Estimated tax</span><span data-test-integ-cart-subtotal-value="">$</span></p><p class=B7xUP><span data-test-integ-cart-subtotal-label=""class=OGw7rb>Estimated total</span><span data-test-integ-cart-subtotal-value=""class=OGw7rb> $</span></p></div></div><section class=JM2zDb>'),ve=D('<section class=kGEQJf><section class=Z722Ge><section class=VcJUVb><section class=h7Oog><span class=YdB1ac><img class=bwpkad alt=sf></span><section class=pFJUxe><section class=wDj5sf><span data-line-number=1><span class=XNnpOb href=#> </span></span></section><section class=DHk3Fe><section class=Jm2qx><span aria-hidden=true>Qty:</span><select class=RIw0b aria-label="Product Quantity"></select></section><p class=GehUpe data-test-line-item-price=""><span data-test-integ-cart-current-price="">$</span></p><section class=dEfaq><section class=JpKBkb><button class=yjHiqb><span>Remover'),$e=D("<option selected>"),Ce=D("<option>"),xe=D('<div><div class=QCNFEe><p class=jhB0af>Confirmar Orden</p></div><p class=B7xUP><span data-test-integ-cart-subtotal-label="">Desea completar la orden y actualizar el inventario</span></p><div class=separator></div><div style=margin:15px class=" spaceAround centerBx">'),Pe=D('<section class=kGEQJf><section class=Z722Ge><section class=VcJUVb><section class=h7Oog><span class=YdB1ac><img class=bwpkad alt=sf></span><section class=pFJUxe><section class=wDj5sf><span data-line-number=1><span class=XNnpOb href=#> </span></span></section><section class=DHk3Fe><section class=Jm2qx></section><p class=GehUpe data-test-line-item-price=""><span data-test-integ-cart-current-price="">$</span></p><section class=dEfaq><section class=JpKBkb><button class=yjHiqb jsaction=click:IY6UFe data-line-number=1 data-test-remove-btn=1 aria-label="Remove Nest Doorbell (wired, 2nd gen) (Snow) from cart"><span>Remove');const Se=I(()=>E(()=>import("./FlexSpace-CFLL4crq.js"),__vite__mapDeps([0,1,2]))),ee=I(()=>E(()=>import("./SVG-LCo5ObZa.js"),__vite__mapDeps([3,1,2])));I(()=>E(()=>import("./LoadingColorSpinner-Bqi6dCjg.js"),__vite__mapDeps([13,1,2,14])));const we=I(()=>E(()=>import("./InputHr-DAw4euwU.js"),__vite__mapDeps([11,1,2,12]))),X=I(()=>E(()=>import("./ButonHrm-C3-e3Mom.js"),__vite__mapDeps([15,1,2,3,16])));I(()=>E(()=>import("./ItemOnSalesPos-DkRGlAAz.js"),__vite__mapDeps([17,1,2,9,10,18])));const[F,B]=H({items:{}}),O="348723orh2idsffs";function Ge(){T(0),T(0);const[e,i]=T("");le(()=>{}),se(()=>{}),G(()=>{o()});const o=async()=>{(await Oe())?.map(l=>{B("items",l.doc)})};return(()=>{var m=he(),l=m.firstChild,r=l.firstChild,g=r.firstChild;return h(g,y(L,{get when(){return k(F?.items?.cart)},get children(){return y(Y,{get each(){return k(F?.items?.cart)},children:(b,p)=>y(ke,{get itm(){return F?.items?.cart?.[b]}})})}})),h(l,y(Ie,{updSearch:i}),null),h(l,y(Ee,{get item(){return F?.items?.cart}}),null),m})()}const Ie=e=>{const[i,o]=T(""),[m,l]=T(1),r=()=>{m()===1&&i().length>8&&g(i())},g=async c=>{U?.profile?.agencyStore?.id;let f=`${c}`,s=await N(f),t=k(s)?.[0],a=`${t}`,_=await W(a),n=0,u=0;k(_)?.map(x=>{_[x]?.products?.map(S=>{t===S?.product?.id&&(n+=S?.price*1*S?.qty*1,u+=S?.qty*1)})});let v=1,C=await V(O)||{};C?.cart?.[t]&&(v=C?.cart?.[t].qty*1+1);const Q=u?n/u:0;if(s?.[t]?.salePrice)if(u&&s?.[t]?.salePrice&&u-v>=0){let x=C;if(C?.cart||(x.cart={},x._id=O),C?.cart?.[t])x.cart[t].qty=v;else{let S={product:{id:t,label:s?.[t]?.name,code:s?.[t]?.code},qty:v,price:Q,salePrice:s?.[t]?.salePrice};x.cart[t]=S}A.put(x,function(j,Z){}),B("items",x),o(""),q({text:s?.[t]?.name+" agregado al carrito",timeout:3500,theme:"blue",id:P()})}else q({text:"Sin Existencia",timeout:3500,theme:"red",id:P()});else{q({text:"Sin precio de venta",timeout:3500,theme:"red",id:P()});return}},[b,{refetch:p}]=ce(i,async c=>{if(m()===2&&c.length>4){const f=await N(c);let s=[];return k(f).map(t=>{let a=f[t];s.push(a)}),s}else return[]}),d=()=>{o(""),l(1)};return(()=>{var c=be(),f=c.firstChild,s=f.firstChild,t=s.firstChild,a=t.firstChild,_=a.nextSibling;return h(s,y(L,{get when(){return b()?.length>0},get children(){var n=ge();return h(n,y(Y,{get each(){return b()},children:(u,v)=>y(Ae,{itm:u,clearTx:d})})),n}}),t),h(t,y(we,{width:"260px",backColor:"#ffffff",borderColor:"#b2b2b2",borderActiveColor:"var(--background-red-ssg)",get value(){return i()},placeholder:"buscar productos ...",colors:"#2b2b2b",handleClick:o,onEnter:r}),a),a.$$click=()=>l(1),h(a,y(ee,{name:"qrcode-scan",size:22,get color(){return m()===1?"#646cff":""}})),_.$$click=()=>l(2),h(_,y(ee,{name:"keyboard",size:22,get color(){return m()===2?"#646cff":""}})),c})()},Ee=e=>{const i=l=>{let r=0;return k(e?.item)?.map(g=>{let b=e?.item?.[g];r+=b?.qty*1*b?.salePrice}),r},o=async l=>{let r=new Date,g=P(),b=me(F?.items?.cart),p=[];k(b).map(n=>{let u={...b[n]};u.qty=u.qty*-1,p.push(u)});let d={type:"SALES",invoice:r.getFullYear()+pe(12),description:"",store:U?.profile?.agencyStore?.id,hbl:"",products:p,ssg_inventory_key:g,ssg_sorder_key:g,createDate:r.getTime(),isCompleted:!0,businessId:U?.profile?.businessYId},c={params:{businessId:U?.profile?.businessYId},form:d},f=R(139003),s={...c,...f},t=R(431005),a={...c,...t};if(await M(s),!(await M(a))?.error){_e(l);let u=await V(O);u.cart=void 0,A.put(u,function(C,Q){}),B("items",u)}},m=()=>{let l=P(),r={};r.id=l,r.props={minHeight:"1vh",overlay:!0,height:"93vh",zIndex:450},r.content=y(De,{modalId:l,completeOrder:()=>o(l)}),fe(r)};return(()=>{var l=ye(),r=l.firstChild,g=r.firstChild,b=g.firstChild,p=b.firstChild,d=p.nextSibling,c=d.firstChild,f=c.firstChild,s=f.nextSibling;s.firstChild;var t=c.nextSibling,a=t.firstChild,_=a.nextSibling;_.firstChild;var n=t.nextSibling,u=n.firstChild,v=u.nextSibling;v.firstChild;var C=b.nextSibling;return h(s,()=>i().toFixed(2),null),h(_,()=>(i()*.06).toFixed(2),null),h(v,()=>(i()*.06+i()).toFixed(2),null),h(C,y(L,{get when(){return i()>0},get children(){return y(X,{color:"#646cff",label:"Enviar Orden",icon:"outline_cart",handleClick:m})}})),l})()},ke=e=>{const[i,o]=H(),m=()=>i?.[e?.itm?.product?.id]?.productImageUrl?te()+re()+"/"+i?.[e?.itm?.product?.id]?.productImageUrl:null,l=async()=>{let p=e?.itm?.product?.id,d=`${p}`,c=await N(d);c?.[p]?.productImageUrl&&o(p,c?.[p])};G(()=>{l()});let r=Array.from(Array(10).keys());const g=async p=>{U?.profile?.agencyStore?.id;let d=e?.itm?.product?.id,c=`${d}`,f=await W(c),s=0,t=0;k(f)?.map(_=>{f[_]?.products?.map(n=>{d===n?.product?.id&&(s+=n?.price*1*n?.qty*1,t+=n?.qty*1)})});const a=t?s/t:0;if(e?.itm?.salePrice)if(t&&e?.itm?.salePrice&&t-p>=0){let _=await V(O)||{},n=_;if(_?.cart||(n.cart={},n._id=O),_?.cart?.[d])n.cart[d].qty=p;else{let u={product:{id:d,label:e?.itm?.name,code:e?.itm?.code},qty:p,price:a,salePrice:e?.itm?.salePrice};n.cart[d]=u}A.put(n,function(v,C){}),B("items",n),q({text:" El carrito fue actualizado",timeout:3500,theme:"blue",id:P()})}else console.log(e?.itm?.qty),q({text:"Sin Existencia",timeout:3500,theme:"red",id:P()});else{q({text:"Sin precio de venta",timeout:3500,theme:"red",id:P()});return}},b=()=>{A.get(O,function(d,c){let f={...c};delete f.cart[e?.itm?.product?.id],A.put(f,function(t,a){t||B("items","cart",e?.itm?.product?.id,void 0)})})};return(()=>{var p=ve(),d=p.firstChild,c=d.firstChild,f=c.firstChild,s=f.firstChild,t=s.firstChild,a=s.nextSibling,_=a.firstChild,n=_.firstChild,u=n.firstChild;u.firstChild;var v=_.nextSibling,C=v.firstChild,Q=C.firstChild,x=Q.nextSibling,S=C.nextSibling,j=S.firstChild;j.firstChild;var Z=S.nextSibling,ie=Z.firstChild,ae=ie.firstChild;return h(u,()=>e?.itm?.product?.label,null),x.addEventListener("change",$=>{g($?.target?.value)}),h(x,y(Y,{each:r,children:($,z)=>y(L,{get when(){return $*1+1===e?.itm?.qty*1},get fallback(){return(()=>{var w=Ce();return w.value=$*1+1+"",h(w,$*1+1),w})()},get children(){var w=$e();return w.value=$*1+1+"",h(w,$*1+1),w}})})),h(j,()=>(e?.itm?.salePrice*1).toFixed(2),null),ae.$$click=b,K($=>{var z=m(),w=e?.itm?.qty;return z!==$.e&&J(t,"src",$.e=z),w!==$.t&&J(x,"aria-value",$.t=w),$},{e:void 0,t:void 0}),p})()},N=async(e,i)=>{let o={params:{businessId:U?.profile?.businessYId}};e&&e.split(" ").map((r,g)=>{r&&(o.params[":search"+g]=r.trim())});let m=R(122001);o={...o,...m},o.params[":search0"];const l=await M(o);return l?.error?{}:l},Ye=async e=>{let i=[];e.map(o=>{let m={params:{id:o?.ssg_track_key,idairguide:"all"}},l=R(802002);m={...m,...l},i.push(m)}),ne(i,qe)},qe=async e=>{const o=await oe(e);if(o)return o},Oe=()=>new Promise((e,i)=>{A.allDocs({include_docs:!0,descending:!0},function(o,m){e(m.rows)})});function De(e){return(()=>{var i=xe(),o=i.firstChild,m=o.nextSibling,l=m.nextSibling,r=l.nextSibling;return i.style.setProperty("max-height","80vh"),i.style.setProperty("overflow","auto"),i.style.setProperty("background","#fff"),i.style.setProperty("border-radius","11px"),i.style.setProperty("padding"," 0 21px"),h(r,y(Se,{}),null),h(r,y(X,{color:"#646cff",icon:"send",label:"Completar Orden",get handleClick(){return e.completeOrder}}),null),K(g=>(g=ue()?"96vw":"420px")!=null?i.style.setProperty("width",g):i.style.removeProperty("width")),i})()}const Ae=e=>{const[i,o]=H(),m=()=>i?.prod?.productImageUrl?te()+re()+"/"+i?.prod?.productImageUrl:null;G(()=>{o("prod",e?.itm)}),Array.from(Array(10).keys());const l=async()=>{let r=i?.prod?.ssg_product_key;U?.profile?.agencyStore?.id;let g=`${r} `,b=await W(g),p=0,d=0;k(b)?.map(t=>{b[t]?.products?.map(a=>{r===a?.product?.id&&(p+=a?.price*1*a?.qty*1,d+=a?.qty*1)})});let c=1,f=await V(O)||{};f?.cart?.[r]&&(c=f?.cart?.[r].qty+1);const s=d?p/d:0;if(e?.itm?.salePrice)if(d&&e?.itm?.salePrice&&d-c>=0){let t=await V(O)||{},a=t;if(t?.cart||(a.cart={},a._id=O),t?.cart?.[r])a.cart[r].qty=c;else{let _={product:{id:r,label:e?.itm?.name,code:e?.itm?.code},qty:c,price:s,salePrice:e?.itm?.salePrice};a.cart[r]=_}A.put(a,function(n,u){}),B("items",a),e?.clearTx(),q({text:" El carrito fue actualizado",timeout:3500,theme:"blue",id:P()})}else q({text:"Sin Existencia",timeout:3500,theme:"red",id:P()});else{q({text:"Sin precio de venta",timeout:3500,theme:"red",id:P()});return}};return y(L,{get when(){return e?.itm?.salePrice},get children(){var r=Pe(),g=r.firstChild,b=g.firstChild,p=b.firstChild,d=p.firstChild,c=d.firstChild,f=d.nextSibling,s=f.firstChild,t=s.firstChild,a=t.firstChild;a.firstChild;var _=s.nextSibling,n=_.firstChild,u=n.nextSibling,v=u.firstChild;return v.firstChild,h(a,()=>e?.itm?.name,null),h(n,y(X,{color:"#646cff",label:"Agregar",handleClick:l})),h(v,()=>(e?.itm?.salePrice*1).toFixed(2),null),K(()=>J(c,"src",m())),r}})};de(["click"]);export{N as LookupProducts,F as cartItems,O as cartKey,Ge as default,qe as fetchCSVInve,Oe as loadCarts,Ye as loadProduct,B as setCartItems};
