import{OpenToast as i}from"./Toast-fXe4Q3x-.js";import{j as E,z as C}from"./index-B3sleXVU.js";import{g as d}from"./globalSignal-Cxj3R9Yd.js";import{g as o,f as g}from"./Util-dbxHFpkD.js";let p="No se encontro ningun registro o el codigo es incorrecto";const q=t=>{t=t.split("'").join("-");let r=t.split("/");t.split("-").length>3&&(r=t.split("-").join);let e=r?.[0],a="^[A-Z]{3}[0-9]{4}-[1-9]{5}";const s=new RegExp(a);let n=e.length===13&&s.test(e),c="^[0-9]{4}-[1-9]{4}";const b=new RegExp(c);let u=e.length===9&&b.test(e),h=r.length>4&&e.length===12,m="^Y24[0-9]{6}";const I=new RegExp(m);let f=e.length===9&&I.test(e),w="^[0-9]";const x=new RegExp(w);let k=e.length>6&&e.length<11&&x.test(e);if(n||h||u){let l={idairguide:r?.[0],":search0":r?.[1],":search1":r?.[3]};return n&&(l={idairguide:"175-2383"+e.slice(3,7),":search0":e}),u&&(l={idairguide:"175-2383"+e.slice(0,4),":search0":e}),{params:l,code:1}}else if(k||f)return{txt:e,code:1}},O=async(t,r)=>{let e=q(t),a={timeStamp:new Date().getTime(),latitude:d?.latitude,longitude:d?.longitude,statusId:r,userId:E?.profile?.userId};return navigator.vibrate(200),e.params?await A(e.params,a):e.txt?await H(e.txt,a):{error:{alert:"error",scanData:{consigneeInfo:{ybestate:"Codigo Incorrecto"}}}}},A=async(t,r)=>{let e=await N(t),a=Object.keys(e)?.[0];if(e[a]?.cidentity)return y(e[a],r);i({text:p,timeout:2500,theme:"red",id:o()})},H=async(t,r)=>{let e=await R(t);if(e?.cidentity)return await y(e,r);i({text:p,timeout:2500,theme:"red",id:o()})},y=async(t,r)=>{let e=t?.statusHistory||[];if(e.push(r),C?.roles?.[t?.consigneeInfo?.ybestate]?.isActive)if(t?.currentStatus!==r.statusId){let a={statusHistory:e,currentStatus:r.statusId},s={ssg_track_key:t.ssg_track_key,idairguide:t.idairguide},n=await L(s,a),c={tracking:t?.tracking,idairguide:t.idairguide,city:t?.consigneeInfo?.ybcity,estate:t.estate};return{data:{...n,...c}}}else{let a={consigneeInfo:{ybcity:"Fue escaneado",ybestate:t?.consigneeInfo?.ybestate}};return i({text:"FUE ESCANEADO EN "+t?.consigneeInfo?.ybestate,timeout:3500,theme:"orange",id:o()}),{error:{alert:"warning",scanData:a}}}else{let a={consigneeInfo:{ybestate:"Zona incorrecta"}};return i({text:"ZONA INCORRECTA",timeout:3500,theme:"orange",id:o()}),{error:{alert:"warning",scanData:a}}}},L=async(t,r)=>await g({params:t,query:"updateLogisticYabaExpress",data2update:r}),N=async t=>await g({params:t,query:"getScanLogisticYabaExpress",queryString:"!* contain :search0 AND !* contain :search1 AND !* contain :search2",fldsQry:["idairguide","currentStatus","ssg_track_key","statusHistory","tracking","estate","city","cidentity","consigneeInfo:ybestate","consigneeInfo:ybcity"]}),R=async t=>await g({params:{id:t},query:"getHblsIndex"});export{O as h};
