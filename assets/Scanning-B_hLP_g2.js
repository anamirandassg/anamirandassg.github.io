const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SVG-BJgx9GLA.js","assets/index-DFllEmGK.js","assets/index-BRlA1Q7g.css","assets/Util-DCAGxQXf.js","assets/FlexSpace-ByMz39bD.js","assets/DropDwnSearch-Cv6rC7nk.js","assets/debounces-B_ie3zif.js","assets/DropDwnSearch-DMkLkRPc.css","assets/ScanningCamera-BnBAXeIR.js","assets/html5-qrcode-scanner--0tCUEin.js","assets/Toast-E0cBWHcm.js","assets/Toast-DLpFKn-Q.css","assets/ShowSSG-DeQtndty.js","assets/DialogHRM-BrdwGl49.js","assets/DialogHRM-V9_lZntj.css","assets/ShowScanAlert-Bzot82Z4.js","assets/ShowQRPrintLabel-BRqlj31R.js","assets/fontkit.es-bSs4huUp.js","assets/qrcode-DHy8FFhS.js","assets/InitPrintServices-DJ_AIouE.js","assets/App.module-CbHnVtRQ.js","assets/App-BDG5NEkI.css","assets/ScanningManual-BPZNO7u1.js","assets/LoadingColorSpinner-D-7Cw2gR.js","assets/LoadingColorSpinner-DPNLfwBi.css"])))=>i.map(i=>d[i]);
import{X as F,g as R,B as ae,A as G,Y as ne,c as Q,l as f,_ as y,a as O,b as re,o as ie,d as le,i as c,e as l,Q as V,f as B,z as oe,U as ce,V as W,S as K,F as de,m as z,j as H,h as ue,t as m,W as ge,Z as _e,O as be}from"./index-DFllEmGK.js";import{s as pe}from"./App.module-CbHnVtRQ.js";import{u as d,q as fe,S as q,e as k,I as N,T,g as ye,f as me,U as he,H as ve,G as Se}from"./Util-DCAGxQXf.js";import"./Toast-E0cBWHcm.js";let ke=[400,300,400,300,400],U=[300,80,300,80,300,80,300];const we=e=>{e.split("-").length>3&&(e=e.split("-").join("")),e?.split("/")?.length>=5&&(e=e?.split("/")?.[3]),e=e.split(",")?.[0]?.trim(),e=e.split("'").join("-"),e=e.split(",").join("-"),e=e.split(";").join("-");let t=e.split("/")?.[0];return t.indexOf("230")>=0&&(t="230"+(t.split("230")?.[1]).slice(0,6)),t.indexOf("231")>=0&&(t="231"+(t.split("231")?.[1]).slice(0,5)),{params:{":search0":t},code:1}},Xe=async(e,a)=>{let t=we(e),s={timeStamp:new Date().getTime(),latitude:F?.latitude,longitude:F?.longitude,statusId:a,userId:R?.profile?.userId,userName:R?.profile?.name};if(a&&t?.params)return await Le(t.params,s);{let n=t?.txt||t?.params?.[":search0"];return navigator.vibrate(U),{error:{alert:"error",color:"rgb(200 25 60)",scanData:{consigneeInfo:{ybestate:"Codigo Incorrecto",bagnumber:n}}}}}},Le=async(e,a)=>{let t=null;if(ae()){let s=k("manifestByHbls")?.[e?.[":search0"]],n=k("manifestByKeys")?.[s];t=xe(n,a)}else t=await Ie(e);if(t?.code===203||t?.code===303)return navigator.vibrate(ke),{error:{alert:"warning",color:"#FF6F1D",scanData:t.data}};if(t?.code===200){navigator.vibrate(500);let s={...t.data};return s.tracking=e?.[":search0"],s.timeStamp=new Date().getTime(),ee([...C(),s]),{error:{alert:"success",color:"#0f5223ff",scanData:t.data}}}else if(!t||t?.error){let s={consigneeInfo:{ybestate:"Codigo Incorrecto"}};return navigator.vibrate(U),{error:{alert:"error",color:"rgb(200 25 60)",scanData:s}}}},xe=(e,a)=>{let t={currentStatus:a?.statusId};if(e?.isSSG&&G?.roles?.SSG?.isActive,!G?.roles?.[e?.consigneeInfo?.ybestate]?.isActive)return{code:303,data:{ybestate:"Zona incorrecta",bagnumber:e?.bagnumber}};if(k("ScannedLocByKey")?.[e?.ssg_track_key]?.statusId===a.statusId)return{code:203,data:{consigneeInfo:{ybcity:"Fue escaneado",ybestate:e?.consigneeInfo?.ybestate,bagnumber:e?.bagnumber}}};let s={idairguide:e?.idairguide,city:e?.consigneeInfo?.ybcity,estate:e?.consigneeInfo?.estate,consigneeInfo:{ybestate:e?.consigneeInfo?.ybestate,ybcity:e?.consigneeInfo?.ybcity},bagnumber:e?.bagnumber,isSSG:e?.isSSG},n={...a};n.ssg_track_key=e?.ssg_track_key,n.ssg_scan_key=he();let o={form:n,itmN:s,params:{airguide:e?.guia},actionKey:815005};N.post(o,function(r,D){r||console.log("successfully posted on queue")});let g={...n};g.id=g.ssg_scan_key,g._id=g.ssg_scan_key,T.put(g,function(r,D){r||console.log("Successfully posted")});let w={...k("ScannedLocByKey")};return w[e?.ssg_track_key]=n,d("ScannedLocByKey",w),M(P),{code:200,data:{...s,...t}}},Ie=async(e,a)=>{let t={params:e},s=ye(265002);return t={...t,...s},await me(t)},M=async e=>{N.allDocs({include_docs:!0,descending:!0},function(a,t){e(t.rows)})},P=e=>{let a={};e?.map(t=>{let s=t?.doc?.ssg_track_key,n=t?.doc?.data2update?.currentStatus;a[s]||(a[s]={}),a[s][n]||(a[s][n]=1)}),d("alredyScan",a),Ee(),ne(e?.length)},X=async()=>{let e=await $e(),a={},t={},s={};return e.map(n=>{n?.doc?.hbls?.map(o=>{t[o?.hbl]||(t[o?.hbl]=n?.doc?.ssg_track_key,s[o?.hbl]=n?.doc)}),a[n?.doc?.ssg_track_key]||(a[n?.doc?.ssg_track_key]=n?.doc,a[n?.doc?.ssg_track_key].key=n?.key)}),d("manifestByKeys",a),d("manifestByHbls",t),d("hblsObjDBInd",s),a},$e=()=>new Promise((e,a)=>{q.allDocs({include_docs:!0,descending:!0},function(t,s){e(s.rows)})}),Be=async()=>{let e=await Ce(),a={};e?.map(t=>{let s=t?.doc?.params?.ssg_manifest_key;a[s]||(a[s]=t?.doc)}),d("alinkM",a)},Ce=()=>new Promise((e,a)=>{ve.allDocs({include_docs:!0,descending:!0},function(t,s){e(s.rows)})}),De=async()=>{let e=await Z(),a={};return e?.map(t=>{let s=t?.doc?.ssg_manifest_key;a[s]=t?.doc}),d("manifestList",a),a},Z=()=>new Promise((e,a)=>{fe.allDocs({include_docs:!0,descending:!0},function(t,s){e(s.rows)})}),Ze=async()=>((await Z())?.map(a=>{q.remove(a?.doc,function(s,n){})}),1),Ee=async()=>{await Y()},Ye=async()=>{await De(),await Y(),await Be(),M(P),X()},Oe=()=>new Promise((e,a)=>{T.allDocs({include_docs:!0,descending:!0},function(t,s){e(s.rows)})}),Y=async()=>{let e=await Oe(),a={},t={};return e?.map(s=>{let n=s?.doc?.ssg_scan_key,o=s?.doc?.ssg_track_key;a[n]=s?.doc,t[o]?t[o]?.timeStamp<s?.doc?.timeStamp&&(t[o]=s?.doc):t[o]=s?.doc}),d("ScannedLocList",a),d("ScannedLocByKey",t),a};var Me=m('<ul class=inline><li><div class="_dsplFlx flxWrp spaceAround centerBx"><div class="icon_status centerBx"></div></div><div style=width:135px>Camara</div></li><li><div class="_dsplFlx flxWrp spaceAround centerBx"><div class="icon_status centerBx"></div></div><div style=width:135px>Escaner RF'),Pe=m('<div class="centerBx100 ">'),Ae=m('<div class=" bottombx lowbordr centerBx "style=padding-top:26px;><h5>Escaneados'),je=m('<div><div class="_dsplFlx flxWrp spaceAround centerBx"><h2>Escanear</h2></div><div style=padding:16px></div><div class="_dsplFlx flxWrp spaceAround centerBx"></div><div class=centerBx100 style=margin-top:20px>'),Fe=m("<div class=loader>Loading..."),Re=m('<div style=background:#FFF;width:90%><div class="centerBx bottombx"><div class="icon_status centerBx"></div><h5 class=" centerBx "></h5><p class=" title_scan centerBx "></p></div><div class="centerBx bottombx"><h5></h5><div class=vertseparator></div><h4>');const[Ge,Ve]=Q(),E=f(()=>y(()=>import("./SVG-BJgx9GLA.js"),__vite__mapDeps([0,1,2,3]))),We=f(()=>y(()=>import("./FlexSpace-ByMz39bD.js"),__vite__mapDeps([4,1,2]))),Ke=f(()=>y(()=>import("./DropDwnSearch-Cv6rC7nk.js"),__vite__mapDeps([5,1,2,6,0,3,7]))),ze=f(()=>y(()=>import("./ScanningCamera-BnBAXeIR.js"),__vite__mapDeps([8,1,2,3,9,6,10,11,12,13,14,15,16,17,18,19,20,21]))),He=f(()=>y(()=>import("./ScanningManual-BPZNO7u1.js"),__vite__mapDeps([22,1,2,3,13,14,20,21,10,11])));f(()=>y(()=>import("./LoadingColorSpinner-D-7Cw2gR.js"),__vite__mapDeps([23,1,2,24])));const[_,J]=O(""),[C,ee]=O([]);function Qe(){Q({});const[e,a]=O(1),[t,s]=ge(),n=r=>()=>s(()=>a(r));re(()=>{w()}),ie(()=>{}),le(()=>{H()&&a(0),M(P),X()});function o(){return"geolocation"in navigator}function g(r){be({latitude:r?.coords?.latitude,longitude:r?.coords?.longitude})}function w(){o()?navigator.geolocation.getCurrentPosition(g):showMessage("Geolocation isn't supported by your browser")}const L=()=>_e?.list?.filter(r=>r.id);return(()=>{var r=je(),D=r.firstChild,te=D.nextSibling,A=te.nextSibling,j=A.nextSibling;return c(A,l(Ke,{get list(){return L()},lbl_empty:"Funciones de Escaneado",backColor:"var(--hrm-palette-primary100)",color:"var(--background-red-ssg)",get value(){return _()},borderColor:"#b2b2b2",borderActiveColor:"var(--background-red-ssg)",hasDebounce:!1,onSelect:i=>J(i.id),width:"260px"})),c(j,l(K,{get when(){return _()},get children(){return[(()=>{var i=Me(),h=i.firstChild,b=h.firstChild,x=b.firstChild,p=h.nextSibling,v=p.firstChild,I=v.firstChild;return V(h,"click",n(0),!0),c(x,l(E,{name:"qrcode-scan",size:32,color:"#2b2b2b"})),V(p,"click",n(1),!0),c(I,l(E,{name:"keyboard",size:32,color:"#2b2b2b"})),B(u=>{var S=e()===0,$=e()===1;return S!==u.e&&h.classList.toggle("selected",u.e=S),$!==u.t&&p.classList.toggle("selected",u.t=$),u},{e:void 0,t:void 0}),i})(),(()=>{var i=Pe();return c(i,l(oe,{get fallback(){return Fe()},get children(){return l(ce,{get children(){return[l(W,{get when(){return e()===0},get children(){return l(ze,{get status(){return _()},get locat(){return _()}})}}),l(W,{get when(){return e()===1},get children(){return l(He,{get status(){return _()},get locat(){return _()}})}})]}})}})),B(()=>i.classList.toggle("pending",!!t())),i})()]}}),null),c(j,l(K,{get when(){return C()?.length>0},get children(){return[Ae(),l(de,{get each(){return Se(C(),"timeStamp",0)},children:(i,h)=>(()=>{var b=Re(),x=b.firstChild,p=x.firstChild,v=p.nextSibling,I=v.nextSibling,u=x.nextSibling,S=u.firstChild,$=S.nextSibling,se=$.nextSibling;return c(p,l(E,{get name(){return k("M023009")?.statusListIcons?.[i?.currentStatus]},size:32})),v.style.setProperty("padding","8px"),c(v,()=>i?.idairguide),I.style.setProperty("padding","8px"),c(I,()=>i?.tracking),c(b,l(We,{}),u),c(S,()=>i?.city),c(se,()=>i?.consigneeInfo?.ybestate),B(()=>z(b,`client_item_box gWXAaj jlytmu manifest  ${H()?"isMobile":"centerBx"}`)),b})()})]}}),null),B(()=>z(r,pe.App)),r})()}ue(["click"]);const Je=Object.freeze(Object.defineProperty({__proto__:null,default:Qe,scannedQRs:Ge,setScannedQRs:Ve,setStatus:J,setTaskScan:ee,status:_,taskScan:C},Symbol.toStringTag,{value:"Module"}));export{Je as S,Xe as a,M as b,Ze as c,P as d,De as h,X as i,Ye as l};
