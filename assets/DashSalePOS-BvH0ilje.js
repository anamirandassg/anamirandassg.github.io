const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FlexSpace-DzQCeYU0.js","assets/index-DM3x9O1y.js","assets/index-DI_XrWgU.css","assets/SVG-Da_ROGE2.js","assets/ShowQRProducts-DBqpaZQR.js","assets/ShowQRPrintLabel-DQEXUifP.js","assets/fontkit.es-BfzNkKlP.js","assets/qrcode-DHy8FFhS.js","assets/InitPrintServices-DuJIW5Xa.js","assets/Toast--B9ei7pb.js","assets/Toast-DLpFKn-Q.css","assets/InputHr-XzkYDCNP.js","assets/InputHr-BXFw4d2l.css","assets/LoadingColorSpinner-5f56fgFo.js","assets/LoadingColorSpinner-DPNLfwBi.css","assets/ButonHrm-kPSGqFH3.js","assets/ButonHrm-BSeWNUGQ.css","assets/ItemOnSalesPos-BdMIRNbc.js","assets/components-NhNR7N9u.js"])))=>i.map(i=>d[i]);
import{l as I,_ as S,aF as P,c as N,a as T,o as it,b as st,d as H,i as _,e as g,O as k,F as G,S as L,D as ct,f as Y,z,m as A,n as Q,p as J,U as nt,M as ot,r as dt,t as E,v as V,x as ut,w as pt,y as mt}from"./index-DM3x9O1y.js";import{OpenModal as ft,CloseModal as _t}from"./DialogHRM-e2eolFbB.js";import"./browser-image-compression-BVJ4p9S0.js";import{OpenToast as K}from"./Toast--B9ei7pb.js";import"./fontkit.es-BfzNkKlP.js";import"./qrcode-DHy8FFhS.js";import{g as et,a as rt}from"./handelImagesServices-CnP_xz6d.js";import{LookupInventory as W}from"./DashInventoryMov-D7OqYqm5.js";import{EditInput as ht}from"./SalesDetails-ZWscieD2.js";import"./DashInventory-CT2uZ-Bf.js";import"./AddInventory-Bz6VdCHO.js";import"./debounces-BqV1i-mH.js";import"./DashProducts-CWdVCiJe.js";import"./App.module-CbHnVtRQ.js";import"./FlexSpace-DzQCeYU0.js";import"./print_invoice_service-B_rvnhlv.js";import"./InitPrintServices-DuJIW5Xa.js";I(()=>S(()=>import("./FlexSpace-DzQCeYU0.js"),__vite__mapDeps([0,1,2])));I(()=>S(()=>import("./SVG-Da_ROGE2.js"),__vite__mapDeps([3,1,2])));I(()=>S(()=>import("./ShowQRProducts-DBqpaZQR.js"),__vite__mapDeps([4,1,2,5,6,7,8,9,10])));I(()=>S(()=>import("./InputHr-XzkYDCNP.js"),__vite__mapDeps([11,1,2,12])));const R=t=>new Promise((a,u)=>{P.get(t,function(i,r){a(r)})});var gt=E('<div style="padding:50px 0"><section class=qsuVSc><section class=bLl6je><section class=dvPdhb>'),bt=E('<section class="h6rxkc ">'),yt=E('<section class=KgyCAd><section class=WirBi><section class=""><section class="EMijzc centerBx"><div class="icon_status centerBx "style="margin:0 4px"></div><div class="icon_status centerBx "style="margin:0 4px">'),$t=E('<section class=rtS8wf><div class=X3QHFf><div class="LhAUHc evth2b"><div class=kDdWge><div class=QCNFEe><p class=jhB0af>Summario de la orden</p></div><div class=qntUl><p class=B7xUP><span data-test-integ-cart-subtotal-label="">Subtotal</span><span data-test-integ-cart-subtotal-value="">$</span></p><p class=B7xUP><span data-test-integ-cart-subtotal-label="">Estimated tax</span><span data-test-integ-cart-subtotal-value="">$</span></p><p class=B7xUP><span data-test-integ-cart-subtotal-label=""class=OGw7rb>Estimated total</span><span data-test-integ-cart-subtotal-value=""class=OGw7rb> $</span></p></div></div><section class=JM2zDb>'),vt=E('<section class=kGEQJf><section class=Z722Ge><section class=VcJUVb><section class=h7Oog><span class=YdB1ac><img class=bwpkad alt=sf></span><section class=pFJUxe><section class=wDj5sf><span data-line-number=1><span class=XNnpOb href=#> </span></span></section><section class=DHk3Fe><section class=Jm2qx><span aria-hidden=true>Qty:</span><select class=RIw0b aria-label="Product Quantity"></select></section><p class=GehUpe data-test-line-item-price=""></p><section class=dEfaq><section class=JpKBkb><button class=yjHiqb><span>Remover'),Ct=E("<option selected>"),xt=E("<option>"),Pt=E('<div><div class=QCNFEe><p class=jhB0af>Confirmar Orden</p></div><p class=B7xUP><span data-test-integ-cart-subtotal-label="">Desea completar la orden y actualizar el inventario</span></p><div class=separator></div><div style=margin:15px class=" spaceAround centerBx">'),It=E('<section class=kGEQJf><section class=Z722Ge><section class=VcJUVb><section class=h7Oog><span class=YdB1ac><img class=bwpkad alt=sf></span><section class=pFJUxe><section class=wDj5sf><span data-line-number=1><span class=XNnpOb href=#> </span></span></section><section class=DHk3Fe><section class=Jm2qx></section><p class=GehUpe data-test-line-item-price=""><span data-test-integ-cart-current-price="">$</span></p><section class=dEfaq><section class=JpKBkb><button class=yjHiqb jsaction=click:IY6UFe data-line-number=1 data-test-remove-btn=1 aria-label="Remove Nest Doorbell (wired, 2nd gen) (Snow) from cart"><span>Remove');const St=I(()=>S(()=>import("./FlexSpace-DzQCeYU0.js"),__vite__mapDeps([0,1,2]))),tt=I(()=>S(()=>import("./SVG-Da_ROGE2.js"),__vite__mapDeps([3,1,2])));I(()=>S(()=>import("./LoadingColorSpinner-5f56fgFo.js"),__vite__mapDeps([13,1,2,14])));const wt=I(()=>S(()=>import("./InputHr-XzkYDCNP.js"),__vite__mapDeps([11,1,2,12]))),X=I(()=>S(()=>import("./ButonHrm-kPSGqFH3.js"),__vite__mapDeps([15,1,2,3,16])));I(()=>S(()=>import("./ItemOnSalesPos-BdMIRNbc.js"),__vite__mapDeps([17,1,2,9,10,18])));const[F,U]=N({items:{}}),w="348723orh2idsffs";function Xt(){T(0),T(0);const[t,a]=T("");it(()=>{}),st(()=>{}),H(()=>{u()});const u=async()=>{(await Dt())?.map(i=>{U("items",i.doc)})};return(()=>{var p=gt(),i=p.firstChild,r=i.firstChild,h=r.firstChild;return _(h,g(L,{get when(){return k(F?.items?.cart)},get children(){return g(G,{get each(){return k(F?.items?.cart)},children:(b,v)=>g(qt,{get itm(){return F?.items?.cart?.[b]}})})}})),_(i,g(kt,{updSearch:a}),null),_(i,g(Et,{get item(){return F?.items?.cart}}),null),p})()}const kt=t=>{const[a,u]=T(""),[p,i]=T(1),r=()=>{p()===1&&a().length>8&&h(a())},h=async l=>{A?.profile?.agencyStore?.id;let o=`${l}`,c=await M(o),e=k(c)?.[0],s=`${e}`,m=await W(s),f=0,d=0;k(m)?.map(O=>{m[O]?.products?.map(D=>{e===D?.product?.id&&(f+=D?.price*1*D?.qty*1,d+=D?.qty*1)})});let y=1,$=await R(w)||{};$?.cart?.[e]&&(y=$?.cart?.[e].qty*1+1);const B=d?f/d:0;let q=$;if($?.cart||(q.cart={},q._id=w),$?.cart?.[e])q.cart[e].qty=y;else{let O={product:{id:e,label:c?.[e]?.name,code:c?.[e]?.code},qty:y,price:B,salePrice:c?.[e]?.salePrice};q.cart[e]=O}P.put(q,function(D,Z){}),U("items",q),u(""),K({text:c?.[e]?.name+" agregado al carrito",timeout:3500,theme:"blue",id:V()})},[b,{refetch:v}]=ct(a,async l=>{if(p()===2&&l.length>4){const o=await M(l);let c=[];return k(o).map(e=>{let s=o[e];c.push(s)}),c}else return[]}),n=()=>{u(""),i(1)};return(()=>{var l=yt(),o=l.firstChild,c=o.firstChild,e=c.firstChild,s=e.firstChild,m=s.nextSibling;return _(c,g(L,{get when(){return b()?.length>0},get children(){var f=bt();return _(f,g(G,{get each(){return b()},children:(d,y)=>g(Ut,{itm:d,clearTx:n})})),f}}),e),_(e,g(wt,{width:"260px",backColor:"#ffffff",borderColor:"#b2b2b2",borderActiveColor:"var(--background-red-ssg)",get value(){return a()},placeholder:"buscar productos ...",colors:"#2b2b2b",handleClick:u,onEnter:r}),s),s.$$click=()=>i(1),_(s,g(tt,{name:"qrcode-scan",size:22,get color(){return p()===1?"#646cff":""}})),m.$$click=()=>i(2),_(m,g(tt,{name:"keyboard",size:22,get color(){return p()===2?"#646cff":""}})),l})()},Et=t=>{const a=i=>{let r=0;return k(t?.item)?.map(h=>{let b=t?.item?.[h];r+=b?.qty*1*b?.salePrice}),r},u=async i=>{let r=new Date,h=V(),b=pt(F?.items?.cart),v=[];k(b).map(f=>{let d={...b[f]};d.qty=d.qty*-1,v.push(d)});let n={type:"SALES",invoice:r.getFullYear()+mt(12),description:"",store:A?.profile?.agencyStore?.id,hbl:"",products:v,ssg_inventory_key:h,ssg_sorder_key:h,createDate:r.getTime(),isCompleted:!0,businessId:A?.profile?.businessYId},l={params:{businessId:A?.profile?.businessYId},form:n},o=Q(139003),c={...l,...o},e=Q(431005),s={...l,...e};if(await J(c),!(await J(s))?.error){_t(i);let d=await R(w);d.cart=void 0,P.put(d,function($,B){}),U("items",d)}},p=()=>{let i=V(),r={};r.id=i,r.props={minHeight:"1vh",overlay:!0,height:"93vh",zIndex:450},r.content=g(At,{modalId:i,completeOrder:()=>u(i)}),ft(r)};return(()=>{var i=$t(),r=i.firstChild,h=r.firstChild,b=h.firstChild,v=b.firstChild,n=v.nextSibling,l=n.firstChild,o=l.firstChild,c=o.nextSibling;c.firstChild;var e=l.nextSibling,s=e.firstChild,m=s.nextSibling;m.firstChild;var f=e.nextSibling,d=f.firstChild,y=d.nextSibling;y.firstChild;var $=b.nextSibling;return _(c,()=>a().toFixed(2),null),_(m,()=>(a()*.06).toFixed(2),null),_(y,()=>(a()*.06+a()).toFixed(2),null),_($,g(L,{get when(){return a()>0},get children(){return g(X,{color:"#646cff",label:"Enviar Orden",icon:"outline_cart",handleClick:p})}})),i})()},qt=t=>{const[a,u]=N(),p=()=>a?.[t?.itm?.product?.id]?.productImageUrl?et()+rt()+"/"+a?.[t?.itm?.product?.id]?.productImageUrl:null,i=async()=>{let n=t?.itm?.product?.id,l=`${n}`,o=await M(l);o?.[n]?.productImageUrl&&u(n,o?.[n])};H(()=>{i()});let r=Array.from(Array(20).keys());const h=async n=>{A?.profile?.agencyStore?.id;let l=t?.itm?.product?.id,o=`${l}`,c=await W(o),e=0,s=0;k(c)?.map(y=>{c[y]?.products?.map($=>{l===$?.product?.id&&(e+=$?.price*1*$?.qty*1,s+=$?.qty*1)})});const m=s?e/s:0;let f=await R(w)||{},d=f;if(f?.cart||(d.cart={},d._id=w),f?.cart?.[l])d.cart[l].qty=n;else{let y={product:{id:l,label:t?.itm?.name,code:t?.itm?.code},qty:n,price:m,salePrice:t?.itm?.salePrice};d.cart[l]=y}P.put(d,function($,B){}),U("items",d),K({text:" El carrito fue actualizado",timeout:3500,theme:"blue",id:V()})},b=()=>{P.get(w,function(l,o){let c={...o};delete c.cart[t?.itm?.product?.id],P.put(c,function(s,m){s||U("items","cart",t?.itm?.product?.id,void 0)})})},v=(n,l)=>{P.get(w,function(c,e){let s={...e};s.cart[t?.itm?.product?.id][n]=l,P.put(s,function(f,d){f||U("items","cart",t?.itm?.product?.id,n,l)})})};return(()=>{var n=vt(),l=n.firstChild,o=l.firstChild,c=o.firstChild,e=c.firstChild,s=e.firstChild,m=e.nextSibling,f=m.firstChild,d=f.firstChild,y=d.firstChild;y.firstChild;var $=f.nextSibling,B=$.firstChild,q=B.firstChild,O=q.nextSibling,D=B.nextSibling,Z=D.nextSibling,at=Z.firstChild,lt=at.firstChild;return _(y,()=>t?.itm?.product?.label,null),O.addEventListener("change",C=>{h(C?.target?.value)}),_(O,g(G,{each:r,children:(C,j)=>g(L,{get when(){return C*1+1===t?.itm?.qty*1},get fallback(){return(()=>{var x=xt();return x.value=C*1+1+"",_(x,C*1+1),x})()},get children(){var x=Ct();return x.value=C*1+1+"",_(x,C*1+1),x}})})),_(D,g(ht,{value:"",get label(){return`${(t?.itm?.salePrice*1).toFixed(2)}`},key:"salePrice",updItem:v,width:"600px"})),lt.$$click=b,Y(C=>{var j=p(),x=t?.itm?.qty;return j!==C.e&&z(s,"src",C.e=j),x!==C.t&&z(O,"aria-value",C.t=x),C},{e:void 0,t:void 0}),n})()},M=async(t,a)=>{let u={params:{businessId:A?.profile?.businessYId}};t&&t.split(" ").map((r,h)=>{r&&(u.params[":search"+h]=r.trim())});let p=Q(122001);u={...u,...p},u.params[":search0"];const i=await J(u);return i?.error?{}:i},Zt=async t=>{let a=[];t.map(u=>{let p={params:{id:u?.ssg_track_key,idairguide:"all"}},i=Q(802002);p={...p,...i},a.push(p)}),nt(a,Ot)},Ot=async t=>{const u=await ot(t);if(u)return u},Dt=()=>new Promise((t,a)=>{P.allDocs({include_docs:!0,descending:!0},function(u,p){t(p.rows)})});function At(t){return(()=>{var a=Pt(),u=a.firstChild,p=u.nextSibling,i=p.nextSibling,r=i.nextSibling;return a.style.setProperty("max-height","80vh"),a.style.setProperty("overflow","auto"),a.style.setProperty("background","#fff"),a.style.setProperty("border-radius","11px"),a.style.setProperty("padding"," 0 21px"),_(r,g(St,{}),null),_(r,g(X,{color:"#646cff",icon:"send",label:"Completar Orden",get handleClick(){return t.completeOrder}}),null),Y(h=>(h=ut()?"96vw":"420px")!=null?a.style.setProperty("width",h):a.style.removeProperty("width")),a})()}const Ut=t=>{const[a,u]=N(),p=()=>a?.prod?.productImageUrl?et()+rt()+"/"+a?.prod?.productImageUrl:null;H(()=>{u("prod",t?.itm)}),Array.from(Array(10).keys());const i=async()=>{let r=a?.prod?.ssg_product_key;A?.profile?.agencyStore?.id;let h=`${r} `,b=await W(h),v=0,n=0;k(b)?.map(s=>{b[s]?.products?.map(m=>{r===m?.product?.id&&(v+=m?.price*1*m?.qty*1,n+=m?.qty*1)})});let l=1,o=await R(w)||{};o?.cart?.[r]&&(l=o?.cart?.[r].qty+1);const c=n?v/n:0;t?.itm?.salePrice;let e=o;if(o?.cart||(e.cart={},e._id=w),o?.cart?.[r])e.cart[r].qty=l;else{let s={product:{id:r,label:t?.itm?.name,code:t?.itm?.code},qty:l,price:c,salePrice:t?.itm?.salePrice};e.cart[r]=s}P.put(e,function(m,f){}),U("items",e),t?.clearTx(),K({text:" El carrito fue actualizado",timeout:3500,theme:"blue",id:V()})};return g(L,{get when(){return t?.itm?.salePrice},get children(){var r=It(),h=r.firstChild,b=h.firstChild,v=b.firstChild,n=v.firstChild,l=n.firstChild,o=n.nextSibling,c=o.firstChild,e=c.firstChild,s=e.firstChild;s.firstChild;var m=c.nextSibling,f=m.firstChild,d=f.nextSibling,y=d.firstChild;return y.firstChild,_(s,()=>t?.itm?.name,null),_(f,g(X,{color:"#646cff",label:"Agregar",handleClick:i})),_(y,()=>(t?.itm?.salePrice*1).toFixed(2),null),Y(()=>z(l,"src",p())),r}})};dt(["click"]);export{M as LookupProducts,F as cartItems,w as cartKey,Xt as default,Ot as fetchCSVInve,Dt as loadCarts,Zt as loadProduct,U as setCartItems};
