const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FlexSpace-706evcOF.js","assets/index-BSIjyJfa.js","assets/index-mNJWtuMT.css","assets/SVG-C1zA0ONa.js","assets/Util-7ERmh4Cp.js","assets/ShowQRProducts-BSUdY7Z-.js","assets/ShowQRPrintLabel-NdyrXERw.js","assets/PDFButton-DXdwVZ_H.js","assets/qrcode-DHy8FFhS.js","assets/fontkit.es-hw3Kqgbm.js","assets/InitPrintServices-C5c3gOIX.js","assets/Toast-2Hx1ttoB.js","assets/Toast-DLpFKn-Q.css","assets/InputHr-CP3C1gBK.js","assets/InputHr-BXFw4d2l.css","assets/LoadingColorSpinner-DcvNNmNL.js","assets/LoadingColorSpinner-DPNLfwBi.css","assets/ButonHrm-osw6qfti.js","assets/ButonHrm-BSeWNUGQ.css","assets/ItemOnSalesPos-CiVDQKhC.js","assets/components-BIXotpF7.js"])))=>i.map(i=>d[i]);
import{l as w,_ as I,c as H,a as L,o as st,b as it,e as G,i as h,f as g,F as Y,S as R,p as ct,h as K,k as J,g as U,x as nt,d as ot,t as k,j as dt}from"./index-BSIjyJfa.js";import{I as D,O as q,g as j,f as M,m as ut,k as pt,a as A,b as mt,c as ft}from"./Util-7ERmh4Cp.js";import{OpenModal as _t,CloseModal as ht}from"./DialogHRM-BvlMAGRm.js";import"./browser-image-compression-BVJ4p9S0.js";import{OpenToast as B}from"./Toast-2Hx1ttoB.js";import"./PDFButton-DXdwVZ_H.js";import"./qrcode-DHy8FFhS.js";import"./fontkit.es-hw3Kqgbm.js";import{g as rt,a as at}from"./handelImagesServices-FxsWq_D2.js";import{LookupInventory as W}from"./DashInventoryMov-DbDOztKF.js";import"./DashInventory-Bh18-vWS.js";import"./App.module-CbHnVtRQ.js";w(()=>I(()=>import("./FlexSpace-706evcOF.js"),__vite__mapDeps([0,1,2])));w(()=>I(()=>import("./SVG-C1zA0ONa.js"),__vite__mapDeps([3,1,2,4])));w(()=>I(()=>import("./ShowQRProducts-BSUdY7Z-.js"),__vite__mapDeps([5,1,2,6,7,4,8,9,10,11,12])));w(()=>I(()=>import("./InputHr-CP3C1gBK.js"),__vite__mapDeps([13,1,2,14])));const Q=e=>new Promise((r,d)=>{D.get(e,function(i,l){r(l)})});var gt=k('<div style="padding:50px 0"><section class=qsuVSc><section class=bLl6je><section class=dvPdhb>'),bt=k('<section class="h6rxkc ">'),yt=k('<section class=KgyCAd><section class=WirBi><section class=""><section class="EMijzc centerBx"><div class="icon_status centerBx "style="margin:0 4px"></div><div class="icon_status centerBx "style="margin:0 4px">'),$t=k('<section class=rtS8wf><div class=X3QHFf><div class="LhAUHc evth2b"><div class=kDdWge><div class=QCNFEe><p class=jhB0af>Summario de la orden</p></div><div class=qntUl><p class=B7xUP><span data-test-integ-cart-subtotal-label="">Subtotal</span><span data-test-integ-cart-subtotal-value="">$</span></p><p class=B7xUP><span data-test-integ-cart-subtotal-label="">Estimated tax</span><span data-test-integ-cart-subtotal-value="">$</span></p><p class=B7xUP><span data-test-integ-cart-subtotal-label=""class=OGw7rb>Estimated total</span><span data-test-integ-cart-subtotal-value=""class=OGw7rb> $</span></p></div></div><section class=JM2zDb>'),vt=k('<section class=kGEQJf><section class=Z722Ge><section class=VcJUVb><section class=h7Oog><span class=YdB1ac><img class=bwpkad alt=sf></span><section class=pFJUxe><section class=wDj5sf><span data-line-number=1><span class=XNnpOb href=#> </span></span></section><section class=DHk3Fe><section class=Jm2qx><span aria-hidden=true>Qty:</span><select class=RIw0b aria-label="Product Quantity"></select></section><p class=GehUpe data-test-line-item-price=""><span data-test-integ-cart-current-price="">$</span></p><section class=dEfaq><section class=JpKBkb><button class=yjHiqb><span>Remover'),Ct=k("<option selected>"),xt=k("<option>"),St=k('<div><div class=QCNFEe><p class=jhB0af>Confirmar Orden</p></div><p class=B7xUP><span data-test-integ-cart-subtotal-label="">Desea completar la orden y actualizar el inventario</span></p><div class=separator></div><div style=margin:15px class=" spaceAround centerBx">'),Pt=k('<section class=dEfaq><section><button class="yjHiqb wv2Pxc"jsaction=click:A4e0fe data-line-number=1 data-test-sfl-btn=1 aria-label="Move Nest Doorbell (wired, 2nd gen) (Snow) from cart to save for later cart."><span>Save for later</span></button></section><section class=JpKBkb><button class=yjHiqb jsaction=click:IY6UFe data-line-number=1 data-test-remove-btn=1 aria-label="Remove Nest Doorbell (wired, 2nd gen) (Snow) from cart"><span>Remove'),wt=k('<section class=kGEQJf><section class=Z722Ge><section class=VcJUVb><section class=h7Oog><span class=YdB1ac><img class=bwpkad alt=sf></span><section class=pFJUxe><section class=wDj5sf><span data-line-number=1><span class=XNnpOb href=#> </span></span></section><section class=DHk3Fe><section class=Jm2qx></section><p class=GehUpe data-test-line-item-price=""><span data-test-integ-cart-current-price="">$');const It=w(()=>I(()=>import("./FlexSpace-706evcOF.js"),__vite__mapDeps([0,1,2]))),et=w(()=>I(()=>import("./SVG-C1zA0ONa.js"),__vite__mapDeps([3,1,2,4])));w(()=>I(()=>import("./LoadingColorSpinner-DcvNNmNL.js"),__vite__mapDeps([15,1,2,16])));const kt=w(()=>I(()=>import("./InputHr-CP3C1gBK.js"),__vite__mapDeps([13,1,2,14]))),X=w(()=>I(()=>import("./ButonHrm-osw6qfti.js"),__vite__mapDeps([17,1,2,3,4,18])));w(()=>I(()=>import("./ItemOnSalesPos-CiVDQKhC.js"),__vite__mapDeps([19,1,2,4,11,12,20])));const[V,F]=H({items:{}}),O="348723orh2idsffs";function Gt(){L(0),L(0);const[e,r]=L("");st(()=>{}),it(()=>{}),G(()=>{d()});const d=async()=>{(await At())?.map(i=>{F("items",i.doc)})};return(()=>{var u=gt(),i=u.firstChild,l=i.firstChild,c=l.firstChild;return h(c,g(R,{get when(){return q(V?.items?.cart)},get children(){return g(Y,{get each(){return q(V?.items?.cart)},children:(b,p)=>g(Ot,{get itm(){return V?.items?.cart?.[b]}})})}})),h(i,g(Et,{updSearch:r}),null),h(i,g(qt,{get item(){return V?.items?.cart}}),null),u})()}const Et=e=>{const[r,d]=L(""),[u,i]=L(1),l=()=>{u()===1&&r().length>8&&c(r())},c=async a=>{let f=U?.profile?.agencyStore?.id,m=`${a}`,o=await z(m),t=q(o)?.[0],n=`${t} ${f}`,_=await W(n),s=0,y=0;q(_)?.map(x=>{_[x]?.products?.map(S=>{t===S?.product?.id&&(s+=S?.price*1*S?.qty*1,y+=S?.qty*1)})});let C=1,E=await Q(O)||{};E?.cart?.[t]&&(C=E?.cart?.[t].qty*1+1);const T=y?s/y:0;if(y&&y-C>=0){let x=E;if(E?.cart||(x.cart={},x._id=O),E?.cart?.[t])x.cart[t].qty=C;else{let S={product:{id:t,label:o?.[t]?.name,code:o?.[t]?.code},qty:C,price:T,salePrice:o?.[t]?.salePrice};x.cart[t]=S}D.put(x,function(Z,tt){}),F("items",x),d(""),B({text:o?.[t]?.name+" agregado al carrito",timeout:3500,theme:"blue",id:A()})}else B({text:"Sin Existencia",timeout:3500,theme:"red",id:A()})},[b,{refetch:p}]=ct(r,async a=>{if(u()===2&&a.length>4){const f=await z(a);let m=[];return q(f).map(o=>{let t=f[o];m.push(t)}),m}else return[]}),$=()=>{d(""),i(1)};return(()=>{var a=yt(),f=a.firstChild,m=f.firstChild,o=m.firstChild,t=o.firstChild,n=t.nextSibling;return h(m,g(R,{get when(){return b()?.length>0},get children(){var _=bt();return h(_,g(Y,{get each(){return b()},children:(s,y)=>g(Bt,{itm:s,clearTx:$})})),_}}),o),h(o,g(kt,{width:"260px",backColor:"#ffffff",borderColor:"#b2b2b2",borderActiveColor:"var(--background-red-ssg)",get value(){return r()},placeholder:"buscar productos ...",colors:"#2b2b2b",handleClick:d,onEnter:l}),t),t.$$click=()=>i(1),h(t,g(et,{name:"qrcode-scan",size:22,get color(){return u()===1?"#646cff":""}})),n.$$click=()=>i(2),h(n,g(et,{name:"keyboard",size:22,get color(){return u()===2?"#646cff":""}})),a})()},qt=e=>{const r=i=>{let l=0;return q(e?.item)?.map(c=>{let b=e?.item?.[c];l+=b?.qty*1*b?.salePrice}),l},d=async i=>{let l=new Date,c=A(),b=mt(V?.items?.cart),p=[];q(b).map(_=>{let s={...b[_]};s.qty=s.qty*-1,p.push(s)});let $={type:"SALES",invoice:l.getFullYear()+ft(12),description:"",store:U?.profile?.agencyStore?.id,hbl:"",products:p,ssg_inventory_key:c,ssg_sorder_key:c,createDate:l.getTime(),isCompleted:!0,businessId:U?.profile?.businessYId},a={params:{businessId:U?.profile?.businessYId},form:$},f=j(139003),m={...a,...f},o=j(431005),t={...a,...o};if(await M(m),!(await M(t))?.error){ht(i);let s=await Q(O);s.cart=void 0,D.put(s,function(C,E){}),F("items",s)}},u=()=>{let i=A(),l={};l.id=i,l.props={minHeight:"1vh",overlay:!0,height:"93vh",zIndex:450},l.content=g(Ut,{modalId:i,completeOrder:()=>d(i)}),_t(l)};return(()=>{var i=$t(),l=i.firstChild,c=l.firstChild,b=c.firstChild,p=b.firstChild,$=p.nextSibling,a=$.firstChild,f=a.firstChild,m=f.nextSibling;m.firstChild;var o=a.nextSibling,t=o.firstChild,n=t.nextSibling;n.firstChild;var _=o.nextSibling,s=_.firstChild,y=s.nextSibling;y.firstChild;var C=b.nextSibling;return h(m,()=>r().toFixed(2),null),h(n,()=>(r()*.06).toFixed(2),null),h(y,()=>(r()*.06+r()).toFixed(2),null),h(C,g(R,{get when(){return r()>0},get children(){return g(X,{color:"#646cff",label:"Enviar Orden",icon:"outline_cart",handleClick:u})}})),i})()},Ot=e=>{const[r,d]=H(),u=()=>r?.[e?.itm?.product?.id]?.productImageUrl?rt()+at()+"/"+r?.[e?.itm?.product?.id]?.productImageUrl:null,i=async()=>{let p=e?.itm?.product?.id,$=`${p}`,a=await z($);a?.[p]?.productImageUrl&&d(p,a?.[p])};G(()=>{i()});let l=Array.from(Array(10).keys());const c=async p=>{let $=U?.profile?.agencyStore?.id,a=e?.itm?.product?.id,f=`${a} ${$}`,m=await W(f),o=0,t=0;q(m)?.map(_=>{m[_]?.products?.map(s=>{a===s?.product?.id&&(o+=s?.price*1*s?.qty*1,t+=s?.qty*1)})});const n=t?o/t:0;if(t&&t-p>=0){let _=await Q(O)||{},s=_;if(_?.cart||(s.cart={},s._id=O),_?.cart?.[a])s.cart[a].qty=p;else{let y={product:{id:a,label:e?.itm?.name,code:e?.itm?.code},qty:p,price:n,salePrice:e?.itm?.salePrice};s.cart[a]=y}D.put(s,function(C,E){}),F("items",s),B({text:" El carrito fue actualizado",timeout:3500,theme:"blue",id:A()})}else console.log(e?.itm?.qty),B({text:"Sin Existencia",timeout:3500,theme:"red",id:A()})},b=()=>{D.get(O,function($,a){let f={...a};delete f.cart[e?.itm?.product?.id],D.put(f,function(o,t){o||F("items","cart",e?.itm?.product?.id,void 0)})})};return(()=>{var p=vt(),$=p.firstChild,a=$.firstChild,f=a.firstChild,m=f.firstChild,o=m.firstChild,t=m.nextSibling,n=t.firstChild,_=n.firstChild,s=_.firstChild;s.firstChild;var y=n.nextSibling,C=y.firstChild,E=C.firstChild,T=E.nextSibling,x=C.nextSibling,S=x.firstChild;S.firstChild;var Z=x.nextSibling,tt=Z.firstChild,lt=tt.firstChild;return h(s,()=>e?.itm?.product?.label,null),T.addEventListener("change",v=>{c(v?.target?.value)}),h(T,g(Y,{each:l,children:(v,N)=>g(R,{get when(){return v*1+1===e?.itm?.qty*1},get fallback(){return(()=>{var P=xt();return P.value=v*1+1+"",h(P,v*1+1),P})()},get children(){var P=Ct();return P.value=v*1+1+"",h(P,v*1+1),P}})})),h(S,()=>(e?.itm?.salePrice*1).toFixed(2),null),lt.$$click=b,K(v=>{var N=u(),P=e?.itm?.qty;return N!==v.e&&J(o,"src",v.e=N),P!==v.t&&J(T,"aria-value",v.t=P),v},{e:void 0,t:void 0}),p})()},z=async(e,r)=>{let d={params:{businessId:U?.profile?.businessYId}};e&&e.split(" ").map((l,c)=>{l&&(d.params[":search"+c]=l.trim())});let u=j(122001);d={...d,...u},d.params[":search0"];const i=await M(d);return i?.error?{}:i},Yt=async e=>{let r=[];e.map(d=>{let u={params:{id:d?.ssg_track_key,idairguide:"all"}},i=j(802002);u={...u,...i},r.push(u)}),ut(r,Dt)},Dt=async e=>{const d=await pt(e);if(d)return d},At=()=>new Promise((e,r)=>{D.allDocs({include_docs:!0,descending:!0},function(d,u){e(u.rows)})});function Ut(e){return(()=>{var r=St(),d=r.firstChild,u=d.nextSibling,i=u.nextSibling,l=i.nextSibling;return r.style.setProperty("max-height","80vh"),r.style.setProperty("overflow","auto"),r.style.setProperty("background","#fff"),r.style.setProperty("border-radius","11px"),r.style.setProperty("padding"," 0 21px"),h(l,g(It,{}),null),h(l,g(X,{color:"#646cff",icon:"send",label:"Completar Orden",get handleClick(){return e.completeOrder}}),null),K(c=>(c=dt()?"96vw":"420px")!=null?r.style.setProperty("width",c):r.style.removeProperty("width")),r})()}const Bt=e=>{const[r,d]=H(),u=()=>r?.prod?.productImageUrl?rt()+at()+"/"+r?.prod?.productImageUrl:null;G(()=>{d("prod",e?.itm)}),Array.from(Array(10).keys());const i=async()=>{let l=U?.profile?.agencyStore?.id,c=r?.prod?.ssg_product_key,b=`${c} ${l}`,p=await W(b),$=0,a=0;q(p)?.map(t=>{p[t]?.products?.map(n=>{c===n?.product?.id&&($+=n?.price*1*n?.qty*1,a+=n?.qty*1)})});let f=1,m=await Q(O)||{};m?.cart?.[c]&&(f=m?.cart?.[c].qty+1);const o=a?$/a:0;if(a&&a-f>=0){let t=await Q(O)||{},n=t;if(t?.cart||(n.cart={},n._id=O),t?.cart?.[c])n.cart[c].qty=f;else{let _={product:{id:c,label:e?.itm?.name,code:e?.itm?.code},qty:f,price:o,salePrice:e?.itm?.salePrice};n.cart[c]=_}D.put(n,function(s,y){}),F("items",n),e?.clearTx(),B({text:" El carrito fue actualizado",timeout:3500,theme:"blue",id:A()})}else B({text:"Sin Existencia",timeout:3500,theme:"red",id:A()})};return(()=>{var l=wt(),c=l.firstChild,b=c.firstChild,p=b.firstChild,$=p.firstChild,a=$.firstChild,f=$.nextSibling,m=f.firstChild,o=m.firstChild,t=o.firstChild;t.firstChild;var n=m.nextSibling,_=n.firstChild,s=_.nextSibling,y=s.firstChild;return y.firstChild,h(t,()=>e?.itm?.name,null),h(_,g(X,{color:"#646cff",label:"Agregar",handleClick:i})),h(y,()=>(e?.itm?.salePrice*1).toFixed(2),null),h(n,g(R,{get when(){return nt()},get children(){return Pt()}}),null),K(()=>J(a,"src",u())),l})()};ot(["click"]);export{z as LookupProducts,V as cartItems,O as cartKey,Gt as default,Dt as fetchCSVInve,At as loadCarts,Yt as loadProduct,F as setCartItems};
