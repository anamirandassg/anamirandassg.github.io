import{j as q,z as H}from"./index-C8V4evGH.js";import{g as d}from"./globalSignal-YaySbPky.js";import{f as l}from"./Util-dbxHFpkD.js";const C=async(t,r)=>{t=t.split("'").join("-");let s={timeStamp:new Date().getTime(),latitude:d?.latitude,longitude:d?.longitude,statusId:r,userId:q?.profile?.userId},a=t.split("/");t.split("-").length>3&&(a=t.split("-").join);let e=a?.[0],i="^[A-Z]{3}[0-9]{4}-[1-9]{5}";const o=new RegExp(i);let g=e.length===13&&o.test(e),p="^[0-9]{4}-[1-9]{4}";const b=new RegExp(p);let u=e.length===9&&b.test(e),h=a.length>4&&e.length===12,m="^Y24[0-9]{6}";const w=new RegExp(m);let I=e.length===9&&w.test(e),k="^[0-9]";const f=new RegExp(k);let S=e.length>6&&e.length<11&&f.test(e),c={idairguide:a?.[0],":search0":a?.[1],":search1":a?.[3]};return g&&(c={idairguide:"175-2383"+e.slice(3,7),":search0":e}),u&&(c={idairguide:"175-2383"+e.slice(0,4),":search0":e}),g||h||u?await L(c,s):S||I?await x(e,s):{error:{alert:"error",scanData:{consigneeInfo:{ybestate:"Codigo Incorrecto"}}}}},L=async(t,r)=>{let s=await D(t),a=Object.keys(s)?.[0];if(s[a]?.cidentity)return y(s[a],r)},x=async(t,r)=>{let s=await R(t);if(s?.cidentity)return await y(s,r)},y=async(t,r)=>{let s=t?.statusHistory||[];if(s.push(r),H?.roles?.[t?.consigneeInfo?.ybestate]?.isActive)if(t?.currentStatus!==r.statusId){let a={statusHistory:s,currentStatus:r.statusId},e={ssg_track_key:t.ssg_track_key,idairguide:t.idairguide},i=await E(e,a),o={tracking:t?.tracking,idairguide:t.idairguide,city:t.city,estate:t.estate};return{data:{...i,...o}}}else return{error:{alert:"warning",scanData:{consigneeInfo:{ybcity:"Fue escaneado",ybestate:t?.consigneeInfo?.ybestate}}}};else return{error:{alert:"warning",scanData:{consigneeInfo:{ybestate:"Zona incorrecta"}}}}},E=async(t,r)=>await l({params:t,query:"updateLogisticYabaExpress",data2update:r}),D=async t=>await l({params:t,query:"getScanLogisticYabaExpress",queryString:"!* contain :search0 AND !* contain :search1 AND !* contain :search2",fldsQry:["idairguide","currentStatus","ssg_track_key","statusHistory","tracking","estate","city","cidentity","consigneeInfo:ybestate","consigneeInfo:ybcity"]}),R=async t=>await l({params:{id:t},query:"getHblsIndex"});export{C as h};
