import{OpenToast as n}from"./Toast-DXo7WFrx.js";import{j as H,z as R}from"./index-CaXA0mR0.js";import{g as b}from"./globalSignal-wMqKMl0q.js";import{g as o,f as g,a as u,q as d}from"./Util-D7b_hj3C.js";let h="No se encontro ningun registro o el codigo es incorrecto",m=[400,300,400,300,400],p=[300,80,300,80,300,80,300];const A=e=>{e=e.split("'").join("-");let r=e.split("/");e.split("-").length>3&&(r=e.split("-").join);let t=r?.[0],a="^[A-Z]{3}[0-9]{4}-[1-9]{5}";const s=new RegExp(a);let i=t.length===13&&s.test(t),l="^[0-9]{4}-[1-9]{4}";const I=new RegExp(l);let y=t.length===9&&I.test(t),f=r.length>4&&t.length===12,w="^Y24[0-9]{6}";const k=new RegExp(w);let S=t.length===9&&k.test(t),x="^[0-9]";const C=new RegExp(x);let E=t.length>6&&t.length<11&&C.test(t);if(i||f||y){let c={idairguide:r?.[0],":search0":r?.[1],":search1":r?.[3]};return i&&(c={idairguide:"175-2383"+t.slice(3,7),":search0":t}),y&&(c={idairguide:"175-2383"+t.slice(0,4),":search0":t}),{params:c,code:1}}else if(E||S)return{txt:t,code:1}},B=async(e,r)=>{let t=A(e),a={timeStamp:new Date().getTime(),latitude:b?.latitude,longitude:b?.longitude,statusId:r,userId:H?.profile?.userId};return t?.params?await L(t.params,a):t?.txt?await N(t.txt,a):(navigator.vibrate(p),{error:{alert:"error",scanData:{consigneeInfo:{ybestate:"Codigo Incorrecto"}}}})},L=async(e,r)=>{let t=await D(e),a=Object.keys(t)?.[0];if(t[a]?.cidentity){let s=v(t[a],r);return navigator.vibrate(500),s}n({text:h,timeout:2500,theme:"red",id:o()}),navigator.vibrate(p)},N=async(e,r)=>{let t=await O(e);if(t?.cidentity){let a=await v(t,r);return navigator.vibrate(500),a}n({text:h,timeout:2500,theme:"red",id:o()}),navigator.vibrate(p)},v=async(e,r)=>{let t=e?.statusHistory||[];if(t.push(r),R?.roles?.[e?.consigneeInfo?.ybestate]?.isActive)if(e?.currentStatus!==r.statusId){let a={statusHistory:t,currentStatus:r.statusId},s={ssg_track_key:e.ssg_track_key,idairguide:e.idairguide},i=await _(s,a),l={tracking:e?.tracking,idairguide:e.idairguide,city:e?.consigneeInfo?.ybcity,estate:e.estate};return{data:{...i,...l}}}else{let a={consigneeInfo:{ybcity:"Fue escaneado",ybestate:e?.consigneeInfo?.ybestate}};return n({text:"FUE ESCANEADO EN "+e?.consigneeInfo?.ybestate,timeout:3500,theme:"orange",id:o()}),navigator.vibrate(m),{error:{alert:"warning",scanData:a}}}else{let a={consigneeInfo:{ybestate:"Zona incorrecta"}};return n({text:"ZONA INCORRECTA",timeout:3500,theme:"orange",id:o()}),navigator.vibrate(m),{error:{alert:"warning",scanData:a}}}},_=async(e,r)=>{let t={params:e,data2update:r},a={...u(d())}[809004];return t={...t,...a},await g(t)},D=async e=>{let r={params:e,fldsQry:["idairguide","currentStatus","ssg_track_key","statusHistory","tracking","estate","city","cidentity","consigneeInfo:ybestate","consigneeInfo:ybcity"]},t={...u(d())}[802001];return r={...r,...t},await g(r)},O=async e=>{let r={params:{id:e}},t={...u(d())}[803001];return r={...r,...t},await g(r)};export{B as h};
