const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FlexSpace-CkYJ8wom.js","assets/index-BlMn_6j_.js","assets/index-DEEWbFNK.css","assets/SVG-BAwyYzEz.js","assets/Util-C4Gv2Rs-.js","assets/ShowQRProducts-BpoFUYGk.js","assets/ShowQRPrintLabel-BC5P5SWG.js","assets/PDFButton-CCQT0yk3.js","assets/qrcode-DHy8FFhS.js","assets/fontkit.es-BaZy4qZc.js","assets/InitPrintServices-COQVt4ve.js","assets/Toast-DGx5X4GD.js","assets/Toast-DLpFKn-Q.css","assets/InputHr-CfduWPnF.js","assets/InputHr-M3rJ9grQ.css","assets/LoadingColorSpinner-CfVeazlZ.js","assets/LoadingColorSpinner-DPNLfwBi.css","assets/ButonHrm-D25m287v.js","assets/ButonHrm-BSeWNUGQ.css","assets/ItemOnSalesPos-BYhac8IU.js","assets/components-CunsUjLq.js"])))=>i.map(i=>d[i]);
import{l as S,_ as P,c as M,a as T,o as se,k as le,b as z,i as h,d as g,F as G,S as N,j as ie,e as Q,s as ee,n as A,w as ce,h as ne,t as I,f as oe}from"./index-BlMn_6j_.js";import{G as E,O,c as R,f as H,j as de,i as ue,b as q,g as pe,A as me,H as fe}from"./Util-C4Gv2Rs-.js";import{OpenModal as _e,CloseModal as he}from"./DialogHRM-CJILU5pJ.js";import"./browser-image-compression-BVJ4p9S0.js";import{OpenToast as D}from"./Toast-DGx5X4GD.js";import"./PDFButton-CCQT0yk3.js";import"./qrcode-DHy8FFhS.js";import"./fontkit.es-BaZy4qZc.js";import{g as te,a as re}from"./handelImagesServices-CUOU28dU.js";import{LookupInventory as Y}from"./DashInventoryMov-CJ4PFBb_.js";import"./DashInventory-DYA91qOi.js";import"./App.module-CbHnVtRQ.js";S(()=>P(()=>import("./FlexSpace-CkYJ8wom.js"),__vite__mapDeps([0,1,2])));S(()=>P(()=>import("./SVG-BAwyYzEz.js"),__vite__mapDeps([3,1,2,4])));S(()=>P(()=>import("./ShowQRProducts-BpoFUYGk.js"),__vite__mapDeps([5,1,2,6,7,4,8,9,10,11,12])));S(()=>P(()=>import("./InputHr-CfduWPnF.js"),__vite__mapDeps([13,1,2,14])));const j=t=>new Promise((r,n)=>{E.get(t,function(l,s){r(s)})});var be=I('<div style="padding:50px 0"><section class=qsuVSc><section class=bLl6je><section class=dvPdhb>'),ge=I('<section class="h6rxkc ">'),$e=I('<section class=KgyCAd><section class=WirBi><section class=""><section class="EMijzc centerBx"><div class="icon_status centerBx "style="margin:0 4px"></div><div class="icon_status centerBx "style="margin:0 4px">'),ye=I('<section class=rtS8wf><div class=X3QHFf><div class="LhAUHc evth2b"><div class=kDdWge><div class=QCNFEe><p class=jhB0af>Summario de la orden</p></div><div class=qntUl><p class=B7xUP><span data-test-integ-cart-subtotal-label="">Subtotal</span><span data-test-integ-cart-subtotal-value="">$</span></p><p class=B7xUP><span data-test-integ-cart-subtotal-label="">Estimated tax</span><span data-test-integ-cart-subtotal-value="">$</span></p><p class=B7xUP><span data-test-integ-cart-subtotal-label=""class=OGw7rb>Estimated total</span><span data-test-integ-cart-subtotal-value=""class=OGw7rb> $</span></p></div></div><section class=JM2zDb>'),ve=I('<section class=kGEQJf><section class=Z722Ge><section class=VcJUVb><section class=h7Oog><span class=YdB1ac><img class=bwpkad alt=sf></span><section class=pFJUxe><section class=wDj5sf><span data-line-number=1><span class=XNnpOb href=#> </span></span></section><section class=DHk3Fe><section class=Jm2qx><span aria-hidden=true>Qty:</span><select class=RIw0b aria-label="Product Quantity"></select></section><p class=GehUpe data-test-line-item-price=""><span data-test-integ-cart-current-price="">$</span></p><section class=dEfaq><section class=JpKBkb><button class=yjHiqb><span>Remover'),Ce=I("<option>"),xe=I('<div><div class=QCNFEe><p class=jhB0af>Confirmar Orden</p></div><p class=B7xUP><span data-test-integ-cart-subtotal-label="">Desea completar la orden y actualizar el inventario</span></p><div class=separator></div><div style=margin:15px class=" spaceAround centerBx">'),Se=I('<section class=dEfaq><section><button class="yjHiqb wv2Pxc"jsaction=click:A4e0fe data-line-number=1 data-test-sfl-btn=1 aria-label="Move Nest Doorbell (wired, 2nd gen) (Snow) from cart to save for later cart."><span>Save for later</span></button></section><section class=JpKBkb><button class=yjHiqb jsaction=click:IY6UFe data-line-number=1 data-selected-quantity=1 data-test-remove-btn=1 aria-label="Remove Nest Doorbell (wired, 2nd gen) (Snow) from cart"><span>Remove'),Pe=I('<section class=kGEQJf><section class=Z722Ge><section class=VcJUVb><section class=h7Oog><span class=YdB1ac><img class=bwpkad alt=sf></span><section class=pFJUxe><section class=wDj5sf><span data-line-number=1><span class=XNnpOb href=#> </span></span></section><section class=DHk3Fe><section class=Jm2qx></section><p class=GehUpe data-test-line-item-price=""><span data-test-integ-cart-current-price="">$');const we=S(()=>P(()=>import("./FlexSpace-CkYJ8wom.js"),__vite__mapDeps([0,1,2]))),Z=S(()=>P(()=>import("./SVG-BAwyYzEz.js"),__vite__mapDeps([3,1,2,4])));S(()=>P(()=>import("./LoadingColorSpinner-CfVeazlZ.js"),__vite__mapDeps([15,1,2,16])));const Ie=S(()=>P(()=>import("./InputHr-CfduWPnF.js"),__vite__mapDeps([13,1,2,14]))),K=S(()=>P(()=>import("./ButonHrm-D25m287v.js"),__vite__mapDeps([17,1,2,3,4,18])));S(()=>P(()=>import("./ItemOnSalesPos-BYhac8IU.js"),__vite__mapDeps([19,1,2,4,11,12,20])));const[F,U]=M({items:{}}),w="348723orh2idsffs";function Ge(){T(0),T(0);const[t,r]=T("");se(()=>{}),le(()=>{}),z(()=>{n()});const n=async()=>{(await Ae())?.map(l=>{U("items",l.doc)})};return(()=>{var d=be(),l=d.firstChild,s=l.firstChild,c=s.firstChild;return h(c,g(N,{get when(){return O(F?.items?.cart)},get children(){return g(G,{get each(){return O(F?.items?.cart)},children:($,u)=>g(Oe,{get itm(){return F?.items?.cart?.[$]}})})}})),h(l,g(ke,{updSearch:r}),null),h(l,g(Ee,{get item(){return F?.items?.cart}}),null),d})()}const ke=t=>{const[r,n]=T(""),[d,l]=T(1),s=()=>{d()===1&&r().length>8&&c(r())},c=async a=>{let f=A?.profile?.agencyStore?.id,p=`${a}`,o=await J(p),e=O(o)?.[0],i=`${e} ${f}`,_=await Y(i),m=0,b=0;O(_)?.map(v=>{_[v]?.products?.map(x=>{e===x?.product?.id&&(m+=x?.price*1*x?.qty*1,b+=x?.qty*1)})});let C=1,k=await j(w)||{};k?.cart?.[e]&&(C=k?.cart?.[e].qty*1+1);const V=b?m/b:0;if(b&&b-C>=0){let v=k;if(k?.cart||(v.cart={},v._id=w),k?.cart?.[e])v.cart[e].qty=C;else{let x={product:{id:e,label:o?.[e]?.name,code:o?.[e]?.code},qty:C,price:V,salePrice:o?.[e]?.salePrice};v.cart[e]=x}E.put(v,function(W,X){}),U("items",v),n(""),D({text:o?.[e]?.name+" agregado al carrito",timeout:3500,theme:"blue",id:q()})}else D({text:"Sin Existencia",timeout:3500,theme:"red",id:q()})},[$,{refetch:u}]=ie(r,async a=>{if(d()===2&&a.length>4){const f=await J(a);let p=[];return O(f).map(o=>{let e=f[o];p.push(e)}),p}else return[]}),y=()=>{n(""),l(1)};return(()=>{var a=$e(),f=a.firstChild,p=f.firstChild,o=p.firstChild,e=o.firstChild,i=e.nextSibling;return h(p,g(N,{get when(){return $()?.length>0},get children(){var _=ge();return h(_,g(G,{get each(){return $()},children:(m,b)=>g(Ue,{itm:m,clearTx:y})})),_}}),o),h(o,g(Ie,{width:"260px",backColor:"#ffffff",borderColor:"#b2b2b2",borderActiveColor:"var(--background-red-ssg)",get value(){return r()},placeholder:"buscar productos ...",colors:"#2b2b2b",handleClick:n,onEnter:s}),e),e.$$click=()=>l(1),h(e,g(Z,{name:"qrcode-scan",size:22,get color(){return d()===1?"#646cff":""}})),i.$$click=()=>l(2),h(i,g(Z,{name:"keyboard",size:22,get color(){return d()===2?"#646cff":""}})),a})()},Ee=t=>{const r=l=>{let s=0;return O(t?.item)?.map(c=>{let $=t?.item?.[c];s+=$?.qty*1*$?.salePrice}),s},n=async l=>{let s=new Date,c=q(),$={type:"SALES",invoice:s.getFullYear()+pe(12),description:"",store:A?.profile?.agencyStore?.id,hbl:"",products:me(fe(F?.items?.cart)),ssg_inventory_key:c,ssg_sorder_key:c,createDate:s.getTime(),businessId:A?.profile?.businessYId},u={params:{businessId:A?.profile?.businessYId},form:$},y=R(139003),a={...u,...y},f=R(431005),p={...u,...f};if(await H(a),!(await H(p))?.error){he(l);let i=await j(w);i.cart=void 0,E.put(i,function(m,b){}),U("items",i)}},d=()=>{let l=q(),s={};s.id=l,s.props={minHeight:"1vh",overlay:!0,height:"93vh",zIndex:450},s.content=g(De,{modalId:l,completeOrder:()=>n(l)}),_e(s)};return(()=>{var l=ye(),s=l.firstChild,c=s.firstChild,$=c.firstChild,u=$.firstChild,y=u.nextSibling,a=y.firstChild,f=a.firstChild,p=f.nextSibling;p.firstChild;var o=a.nextSibling,e=o.firstChild,i=e.nextSibling;i.firstChild;var _=o.nextSibling,m=_.firstChild,b=m.nextSibling;b.firstChild;var C=$.nextSibling;return h(p,()=>r().toFixed(2),null),h(i,()=>(r()*.06).toFixed(2),null),h(b,()=>(r()*.06+r()).toFixed(2),null),h(C,g(N,{get when(){return r()>0},get children(){return g(K,{color:"#646cff",label:"Enviar Orden",icon:"outline_cart",handleClick:d})}})),l})()},Oe=t=>{const[r,n]=M(),d=()=>r?.[t?.itm?.product?.id]?.productImageUrl?te()+re()+"/"+r?.[t?.itm?.product?.id]?.productImageUrl:null,l=async()=>{let u=t?.itm?.product?.id,y=`${u}`,a=await J(y);a?.[u]?.productImageUrl&&n(u,a?.[u])};z(()=>{l()});let s=Array.from(Array(10).keys());const c=async u=>{let y=A?.profile?.agencyStore?.id,a=t?.itm?.product?.id,f=`${a} ${y}`,p=await Y(f),o=0,e=0;O(p)?.map(_=>{p[_]?.products?.map(m=>{a===m?.product?.id&&(o+=m?.price*1*m?.qty*1,e+=m?.qty*1)})});const i=e?o/e:0;if(e&&e-u>=0){let _=await j(w)||{},m=_;if(_?.cart||(m.cart={},m._id=w),_?.cart?.[a])m.cart[a].qty=u;else{let b={product:{id:a,label:t?.itm?.name,code:t?.itm?.code},qty:u,price:i,salePrice:t?.itm?.salePrice};m.cart[a]=b}E.put(m,function(C,k){}),U("items",m),D({text:" El carrito fue actualizado",timeout:3500,theme:"blue",id:q()})}else D({text:"Sin Existencia",timeout:3500,theme:"red",id:q()})},$=()=>{E.get(w,function(y,a){let f={...a};delete f.cart[t?.itm?.product?.id],E.put(f,function(o,e){o||U("items","cart",t?.itm?.product?.id,void 0)})})};return(()=>{var u=ve(),y=u.firstChild,a=y.firstChild,f=a.firstChild,p=f.firstChild,o=p.firstChild,e=p.nextSibling,i=e.firstChild,_=i.firstChild,m=_.firstChild;m.firstChild;var b=i.nextSibling,C=b.firstChild,k=C.firstChild,V=k.nextSibling,v=C.nextSibling,x=v.firstChild;x.firstChild;var W=v.nextSibling,X=W.firstChild,ae=X.firstChild;return h(m,()=>t?.itm?.product?.label,null),V.addEventListener("change",B=>{c(B?.target?.value)}),h(V,g(G,{each:s,children:(B,Be)=>(()=>{var L=Ce();return L.value=B*1+1+"",h(L,B*1+1),Q(()=>L.selected=B*1+1===t?.itm?.qty*1),L})()})),h(x,()=>(t?.itm?.salePrice*1).toFixed(2),null),ae.$$click=$,Q(()=>ee(o,"src",d())),u})()},J=async(t,r)=>{let n={params:{businessId:A?.profile?.businessYId}};t&&t.split(" ").map((s,c)=>{s&&(n.params[":search"+c]=s.trim())});let d=R(122001);n={...n,...d},n.params[":search0"];const l=await H(n);return l?.error?{}:l},Ye=async t=>{let r=[];t.map(n=>{let d={params:{id:n?.ssg_track_key,idairguide:"all"}},l=R(802002);d={...d,...l},r.push(d)}),de(r,qe)},qe=async t=>{const n=await ue(t);if(n)return n},Ae=()=>new Promise((t,r)=>{E.allDocs({include_docs:!0,descending:!0},function(n,d){t(d.rows)})});function De(t){return(()=>{var r=xe(),n=r.firstChild,d=n.nextSibling,l=d.nextSibling,s=l.nextSibling;return r.style.setProperty("max-height","80vh"),r.style.setProperty("overflow","auto"),r.style.setProperty("background","#fff"),r.style.setProperty("border-radius","11px"),r.style.setProperty("padding"," 0 21px"),h(s,g(we,{}),null),h(s,g(K,{color:"#646cff",icon:"send",label:"Completar Orden",get handleClick(){return t.completeOrder}}),null),Q(c=>(c=oe()?"96vw":"420px")!=null?r.style.setProperty("width",c):r.style.removeProperty("width")),r})()}const Ue=t=>{const[r,n]=M(),d=()=>r?.prod?.productImageUrl?te()+re()+"/"+r?.prod?.productImageUrl:null;z(()=>{n("prod",t?.itm)}),Array.from(Array(10).keys());const l=async()=>{let s=A?.profile?.agencyStore?.id,c=r?.prod?.ssg_product_key,$=`${c} ${s}`,u=await Y($),y=0,a=0;O(u)?.map(e=>{u[e]?.products?.map(i=>{c===i?.product?.id&&(y+=i?.price*1*i?.qty*1,a+=i?.qty*1)})});let f=1,p=await j(w)||{};p?.cart?.[c]&&(f=p?.cart?.[c].qty+1);const o=a?y/a:0;if(a&&a-f>=0){let e=await j(w)||{},i=e;if(e?.cart||(i.cart={},i._id=w),e?.cart?.[c])i.cart[c].qty=f;else{let _={product:{id:c,label:t?.itm?.name,code:t?.itm?.code},qty:f,price:o,salePrice:t?.itm?.salePrice};i.cart[c]=_}E.put(i,function(m,b){}),U("items",i),t?.clearTx(),D({text:" El carrito fue actualizado",timeout:3500,theme:"blue",id:q()})}else D({text:"Sin Existencia",timeout:3500,theme:"red",id:q()})};return(()=>{var s=Pe(),c=s.firstChild,$=c.firstChild,u=$.firstChild,y=u.firstChild,a=y.firstChild,f=y.nextSibling,p=f.firstChild,o=p.firstChild,e=o.firstChild;e.firstChild;var i=p.nextSibling,_=i.firstChild,m=_.nextSibling,b=m.firstChild;return b.firstChild,h(e,()=>t?.itm?.name,null),h(_,g(K,{color:"#646cff",label:"Agregar",handleClick:l})),h(b,()=>(t?.itm?.salePrice*1).toFixed(2),null),h(i,g(N,{get when(){return ce()},get children(){return Se()}}),null),Q(()=>ee(a,"src",d())),s})()};ne(["click"]);export{J as LookupProducts,F as cartItems,w as cartKey,Ge as default,qe as fetchCSVInve,Ae as loadCarts,Ye as loadProduct,U as setCartItems};
