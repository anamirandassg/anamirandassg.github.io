const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SVG-B-5iyLtm.js","assets/index-BKy_S-Nn.js","assets/index-lCkr9jrN.css","assets/Util-F67-CCle.js","assets/FlexSpace-BwhTX3J3.js","assets/DropDwnSearch-B5C1hTwO.js","assets/debounces-B46jN5Z-.js","assets/DropDwnSearch-DMkLkRPc.css","assets/ScanningCamera-ChN3Zdvi.js","assets/html5-qrcode-scanner-AiZst19y.js","assets/Toast-C3JRIq_B.js","assets/Toast-DLpFKn-Q.css","assets/ShowSSG-BzAxkmuP.js","assets/DialogHRM-CgIthEbm.js","assets/DialogHRM-V9_lZntj.css","assets/ShowScanAlert-Bri1Y9Nh.js","assets/ShowQRPrintLabel-JEJ91U5M.js","assets/PDFButton-CYzToAIH.js","assets/qrcode-DHy8FFhS.js","assets/fontkit.es-BUYa1DnD.js","assets/InitPrintServices-DuQS0_SS.js","assets/App.module-CbHnVtRQ.js","assets/App-BDG5NEkI.css","assets/ScanningManual-B-WsqUlY.js","assets/LoadingColorSpinner-BCniINeC.js","assets/LoadingColorSpinner-DPNLfwBi.css"])))=>i.map(i=>d[i]);
import{Q as P,m as A,y as ne,x as j,R as q,T as re,c as z,l as b,_ as p,a as O,j as ie,o as le,n as oe,i as l,d as i,N as R,e as L,w as ce,U as de,V as G,S as V,F as ue,f as W,g as Q,h as ge,t as _,W as fe,X as be,L as pe}from"./index-BKy_S-Nn.js";import{s as _e}from"./App.module-CbHnVtRQ.js";import{u as f,i as ye,F as H,a as S,O as he,B as K,b as E,f as N,A as ve,z as me}from"./Util-F67-CCle.js";import"./Toast-C3JRIq_B.js";let Se=[400,300,400,300,400],T=[300,80,300,80,300,80,300];const ke=e=>{e.split("-").length>3&&(e=e.split("-").join("")),e?.split("/")?.length>=5&&(e=e?.split("/")?.[3]),e=e.split(",")?.[0]?.trim(),e=e.split("'").join("-"),e=e.split(",").join("-"),e=e.split(";").join("-");let t=e.split("/")?.[0];return t.indexOf("230")>=0&&(t="230"+(t.split("230")?.[1]).slice(0,6)),t.indexOf("231")>=0&&(t="231"+(t.split("231")?.[1]).slice(0,5)),{params:{":search0":t},code:1}},Xe=async(e,a)=>{let t=ke(e),s={timeStamp:new Date().getTime(),latitude:P?.latitude,longitude:P?.longitude,statusId:a,userId:A?.profile?.userId,userName:A?.profile?.name};if(a&&t?.params)return await we(t.params,s);{let n=t?.txt||t?.params?.[":search0"];return navigator.vibrate(T),{error:{alert:"error",color:"rgb(200 25 60)",scanData:{consigneeInfo:{ybestate:"Codigo Incorrecto",bagnumber:n}}}}}},we=async(e,a)=>{let t=null;if(ne()){let s=S("manifestByHbls")?.[e?.[":search0"]],n=S("manifestByKeys")?.[s];t=xe(n,a)}else{let s=await Le(e),n=he(s)?.[0];s?.[n]?.guia&&(t=(await Ie({":search0":n,idairguide:s?.[n]?.guia},a))?.data)}if(t?.code===203||t?.code===303)return navigator.vibrate(Se),{error:{alert:"warning",color:"#FF6F1D",scanData:t.data}};if(t?.code===200){navigator.vibrate(500);let s={...t.data};return s.tracking=e?.[":search0"],s.timeStamp=new Date().getTime(),ee([...$(),s]),{error:{alert:"success",color:"#0f5223ff",scanData:t.data}}}else if(!t||t?.error){let s={consigneeInfo:{ybestate:"Codigo Incorrecto"}};return navigator.vibrate(T),{error:{alert:"error",color:"rgb(200 25 60)",scanData:s}}}},xe=(e,a)=>{let t=e?.statusHistory||[];t.push(a);let s={statusHistory:t,currentStatus:a?.statusId};if(e?.isSSG&&j?.roles?.SSG?.isActive,!j?.roles?.[e?.consigneeInfo?.ybestate]?.isActive)return{code:303,data:{ybestate:"Zona incorrecta",bagnumber:e?.bagnumber}};if(S("alredyScan")?.[a.statusId]?.[e?.ssg_track_key])return{code:203,data:{consigneeInfo:{ybcity:"Fue escaneado",ybestate:e?.consigneeInfo?.ybestate,bagnumber:e?.bagnumber}}};if(e?.currentStatus===a.statusId)return{code:203,data:{consigneeInfo:{ybcity:"Fue escaneado",ybestate:e?.consigneeInfo?.ybestate,bagnumber:e?.bagnumber}}};let n={idairguide:e?.idairguide,city:e?.consigneeInfo?.ybcity,estate:e?.consigneeInfo?.estate,consigneeInfo:{ybestate:e?.consigneeInfo?.ybestate,ybcity:e?.consigneeInfo?.ybcity},bagnumber:e?.bagnumber,isSSG:e?.isSSG},y={data2update:s,itmN:n,ssg_track_key:e?.ssg_track_key,params:{ssg_track_key:e?.ssg_track_key,idairguide:e?.guia},actionKey:809004};return K.post(y,function(C,D){C||console.log("successfully posted on queue")}),$e(e?.ssg_track_key,a.statusId),{code:200,data:{...n,...s}}},Ie=async(e,a)=>{let t={params:e,form:a},s=E(802001);return s=E(802008),t={...t,...s},await N(t)},Le=async(e,a)=>{let t={params:e},s=E(265002);return t={...t,...s},await N(t)},X=async e=>{K.allDocs({include_docs:!0,descending:!0},function(a,t){e(t.rows)})},U=e=>{let a={};e?.map(t=>{let s=t?.doc?.ssg_track_key,n=t?.doc?.data2update?.currentStatus;a[n]||(a[n]={}),a[n][s]||(a[n][s]=1)}),f("alredyScan",a),q(e?.length)},$e=(e,a)=>{let t=S("alredyScan")||{};t[a]||(t[a]={}),t[a][e]||(t[a][e]=1),f("alredyScan",t),q(re()+1)},Z=async()=>{let e=await Ce(),a={},t={};return e.map(s=>{s?.doc?.hbls?.map(n=>{t[n?.hbl]||(t[n?.hbl]=s?.doc?.ssg_track_key)}),a[s?.doc?.ssg_track_key]||(a[s?.doc?.ssg_track_key]=s?.doc,a[s?.doc?.ssg_track_key].key=s?.key)}),f("manifestByKeys",a),f("manifestByHbls",t),a},Ce=()=>new Promise((e,a)=>{H.allDocs({include_docs:!0,descending:!0},function(t,s){e(s.rows)})}),Be=async()=>{let e=await Ee(),a={};e?.map(t=>{let s=t?.doc?.params?.ssg_manifest_key;a[s]||(a[s]=t?.doc)}),f("alinkM",a)},Ee=()=>new Promise((e,a)=>{ve.allDocs({include_docs:!0,descending:!0},function(t,s){e(s.rows)})}),Oe=async()=>{let e=await J(),a={};return e?.map(t=>{let s=t?.doc?.ssg_manifest_key;a[s]=t?.doc}),f("manifestList",a),a},J=()=>new Promise((e,a)=>{ye.allDocs({include_docs:!0,descending:!0},function(t,s){e(s.rows)})}),Ue=async()=>((await J())?.map(a=>{H.remove(a?.doc,function(s,n){})}),1),Ze=async()=>{await Oe(),await Be(),X(U),Z()};var De=_('<ul class=inline><li><div class="_dsplFlx flxWrp spaceAround centerBx"><div class="icon_status centerBx"></div></div><div style=width:135px>Camara</div></li><li><div class="_dsplFlx flxWrp spaceAround centerBx"><div class="icon_status centerBx"></div></div><div style=width:135px>Escaner RF'),Me=_('<div class="centerBx100 ">'),Fe=_('<div class=" bottombx lowbordr centerBx "style=padding-top:26px;><h5>Escaneados'),Pe=_('<div><div class="_dsplFlx flxWrp spaceAround centerBx"><h2>Escanear</h2></div><div style=padding:16px></div><div class="_dsplFlx flxWrp spaceAround centerBx"></div><div class=centerBx100 style=margin-top:20px>'),Ae=_("<div class=loader>Loading..."),je=_('<div style=background:#FFF;width:90%><div class="centerBx bottombx"><div class="icon_status centerBx"></div><h5 class=" centerBx "></h5><p class=" title_scan centerBx "></p></div><div class="centerBx bottombx"><h5></h5><div class=vertseparator></div><h4>');const[Re,Ge]=z(),B=b(()=>p(()=>import("./SVG-B-5iyLtm.js"),__vite__mapDeps([0,1,2,3]))),Ve=b(()=>p(()=>import("./FlexSpace-BwhTX3J3.js"),__vite__mapDeps([4,1,2]))),We=b(()=>p(()=>import("./DropDwnSearch-B5C1hTwO.js"),__vite__mapDeps([5,1,2,6,0,3,7]))),Qe=b(()=>p(()=>import("./ScanningCamera-ChN3Zdvi.js"),__vite__mapDeps([8,1,2,3,9,6,10,11,12,13,14,15,16,17,18,19,20,21,22]))),qe=b(()=>p(()=>import("./ScanningManual-B-WsqUlY.js"),__vite__mapDeps([23,1,2,3,13,14,21,22,10,11])));b(()=>p(()=>import("./LoadingColorSpinner-BCniINeC.js"),__vite__mapDeps([24,1,2,25])));const[d,Y]=O(""),[$,ee]=O([]);function ze(){z({});const[e,a]=O(1),[t,s]=fe(),n=o=>()=>s(()=>a(o));ie(()=>{C()}),le(()=>{}),oe(()=>{Q()&&a(0),X(U),Z()});function y(){return"geolocation"in navigator}function k(o){pe({latitude:o?.coords?.latitude,longitude:o?.coords?.longitude})}function C(){y()?navigator.geolocation.getCurrentPosition(k):showMessage("Geolocation isn't supported by your browser")}const D=()=>be?.list?.filter(o=>o.id);return(()=>{var o=Pe(),te=o.firstChild,ae=te.nextSibling,M=ae.nextSibling,F=M.nextSibling;return l(M,i(We,{get list(){return D()},lbl_empty:"Funciones de Escaneado",backColor:"var(--hrm-palette-primary100)",color:"var(--background-red-ssg)",get value(){return d()},borderColor:"#b2b2b2",borderActiveColor:"var(--background-red-ssg)",hasDebounce:!1,onSelect:r=>Y(r.id),width:"260px"})),l(F,i(V,{get when(){return d()},get children(){return[(()=>{var r=De(),h=r.firstChild,u=h.firstChild,w=u.firstChild,g=h.nextSibling,v=g.firstChild,x=v.firstChild;return R(h,"click",n(0),!0),l(w,i(B,{name:"qrcode-scan",size:32,color:"#2b2b2b"})),R(g,"click",n(1),!0),l(x,i(B,{name:"keyboard",size:32,color:"#2b2b2b"})),L(c=>{var m=e()===0,I=e()===1;return m!==c.e&&h.classList.toggle("selected",c.e=m),I!==c.t&&g.classList.toggle("selected",c.t=I),c},{e:void 0,t:void 0}),r})(),(()=>{var r=Me();return l(r,i(ce,{get fallback(){return Ae()},get children(){return i(de,{get children(){return[i(G,{get when(){return e()===0},get children(){return i(Qe,{get status(){return d()},get locat(){return d()}})}}),i(G,{get when(){return e()===1},get children(){return i(qe,{get status(){return d()},get locat(){return d()}})}})]}})}})),L(()=>r.classList.toggle("pending",!!t())),r})()]}}),null),l(F,i(V,{get when(){return $()?.length>0},get children(){return[Fe(),i(ue,{get each(){return me($(),"timeStamp",0)},children:(r,h)=>(()=>{var u=je(),w=u.firstChild,g=w.firstChild,v=g.nextSibling,x=v.nextSibling,c=w.nextSibling,m=c.firstChild,I=m.nextSibling,se=I.nextSibling;return l(g,i(B,{get name(){return S("M023009")?.statusListIcons?.[r?.currentStatus]},size:32})),v.style.setProperty("padding","8px"),l(v,()=>r?.idairguide),x.style.setProperty("padding","8px"),l(x,()=>r?.tracking),l(u,i(Ve,{}),c),l(m,()=>r?.city),l(se,()=>r?.consigneeInfo?.ybestate),L(()=>W(u,`client_item_box gWXAaj jlytmu manifest  ${Q()?"isMobile":"centerBx"}`)),u})()})]}}),null),L(()=>W(o,_e.App)),o})()}ge(["click"]);const Je=Object.freeze(Object.defineProperty({__proto__:null,default:ze,scannedQRs:Re,setScannedQRs:Ge,setStatus:Y,setTaskScan:ee,status:d,taskScan:$},Symbol.toStringTag,{value:"Module"}));export{Je as S,Xe as a,X as b,Ue as c,U as d,Oe as h,Z as i,Ze as l};
