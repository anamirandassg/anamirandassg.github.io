const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FlexSpace-ZuIl_VRM.js","assets/index-CMPFS5l3.js","assets/index-CaL-WNrg.css","assets/SVG-Bw-dPoFc.js","assets/Util-7ERmh4Cp.js","assets/ShowQRProducts-vnq4pd4I.js","assets/ShowQRPrintLabel-dd3StqUp.js","assets/PDFButton-DXdwVZ_H.js","assets/qrcode-DHy8FFhS.js","assets/fontkit.es-hw3Kqgbm.js","assets/InitPrintServices-C5c3gOIX.js","assets/Toast-DS_YK2AF.js","assets/Toast-DLpFKn-Q.css","assets/InputHr-DWNR00eQ.js","assets/InputHr-BXFw4d2l.css","assets/LoadingColorSpinner-DdRS_GH9.js","assets/LoadingColorSpinner-DPNLfwBi.css","assets/ButonHrm-DIUBNgu5.js","assets/ButonHrm-BSeWNUGQ.css","assets/ItemOnSalesPos-DwbRgMXO.js","assets/components-CwIDaYvQ.js"])))=>i.map(i=>d[i]);
import{l as S,_ as P,c as z,a as T,o as lt,b as st,e as H,i as h,f as y,F as G,S as N,n as it,h as R,k as tt,g as D,w as ct,d as nt,t as E,j as ot}from"./index-CMPFS5l3.js";import{I as q,O as I,g as j,f as J,m as dt,k as ut,a as O,b as pt,c as mt}from"./Util-7ERmh4Cp.js";import{OpenModal as ft,CloseModal as _t}from"./DialogHRM-1fBgaf-_.js";import"./browser-image-compression-BVJ4p9S0.js";import{OpenToast as A}from"./Toast-DS_YK2AF.js";import"./PDFButton-DXdwVZ_H.js";import"./qrcode-DHy8FFhS.js";import"./fontkit.es-hw3Kqgbm.js";import{g as et,a as rt}from"./handelImagesServices-CxXaAJtj.js";import{LookupInventory as Y}from"./DashInventoryMov-v8g4y1bP.js";import"./DashInventory-C7SYd6WF.js";import"./App.module-CbHnVtRQ.js";S(()=>P(()=>import("./FlexSpace-ZuIl_VRM.js"),__vite__mapDeps([0,1,2])));S(()=>P(()=>import("./SVG-Bw-dPoFc.js"),__vite__mapDeps([3,1,2,4])));S(()=>P(()=>import("./ShowQRProducts-vnq4pd4I.js"),__vite__mapDeps([5,1,2,6,7,4,8,9,10,11,12])));S(()=>P(()=>import("./InputHr-DWNR00eQ.js"),__vite__mapDeps([13,1,2,14])));const V=e=>new Promise((r,d)=>{q.get(e,function(i,l){r(l)})});var ht=E('<div style="padding:50px 0"><section class=qsuVSc><section class=bLl6je><section class=dvPdhb>'),bt=E('<section class="h6rxkc ">'),gt=E('<section class=KgyCAd><section class=WirBi><section class=""><section class="EMijzc centerBx"><div class="icon_status centerBx "style="margin:0 4px"></div><div class="icon_status centerBx "style="margin:0 4px">'),yt=E('<section class=rtS8wf><div class=X3QHFf><div class="LhAUHc evth2b"><div class=kDdWge><div class=QCNFEe><p class=jhB0af>Summario de la orden</p></div><div class=qntUl><p class=B7xUP><span data-test-integ-cart-subtotal-label="">Subtotal</span><span data-test-integ-cart-subtotal-value="">$</span></p><p class=B7xUP><span data-test-integ-cart-subtotal-label="">Estimated tax</span><span data-test-integ-cart-subtotal-value="">$</span></p><p class=B7xUP><span data-test-integ-cart-subtotal-label=""class=OGw7rb>Estimated total</span><span data-test-integ-cart-subtotal-value=""class=OGw7rb> $</span></p></div></div><section class=JM2zDb>'),$t=E('<section class=kGEQJf><section class=Z722Ge><section class=VcJUVb><section class=h7Oog><span class=YdB1ac><img class=bwpkad alt=sf></span><section class=pFJUxe><section class=wDj5sf><span data-line-number=1><span class=XNnpOb href=#> </span></span></section><section class=DHk3Fe><section class=Jm2qx><span aria-hidden=true>Qty:</span><select class=RIw0b aria-label="Product Quantity"></select></section><p class=GehUpe data-test-line-item-price=""><span data-test-integ-cart-current-price="">$</span></p><section class=dEfaq><section class=JpKBkb><button class=yjHiqb><span>Remover'),vt=E("<option>"),Ct=E('<div><div class=QCNFEe><p class=jhB0af>Confirmar Orden</p></div><p class=B7xUP><span data-test-integ-cart-subtotal-label="">Desea completar la orden y actualizar el inventario</span></p><div class=separator></div><div style=margin:15px class=" spaceAround centerBx">'),xt=E('<section class=dEfaq><section><button class="yjHiqb wv2Pxc"jsaction=click:A4e0fe data-line-number=1 data-test-sfl-btn=1 aria-label="Move Nest Doorbell (wired, 2nd gen) (Snow) from cart to save for later cart."><span>Save for later</span></button></section><section class=JpKBkb><button class=yjHiqb jsaction=click:IY6UFe data-line-number=1 data-selected-quantity=1 data-test-remove-btn=1 aria-label="Remove Nest Doorbell (wired, 2nd gen) (Snow) from cart"><span>Remove'),St=E('<section class=kGEQJf><section class=Z722Ge><section class=VcJUVb><section class=h7Oog><span class=YdB1ac><img class=bwpkad alt=sf></span><section class=pFJUxe><section class=wDj5sf><span data-line-number=1><span class=XNnpOb href=#> </span></span></section><section class=DHk3Fe><section class=Jm2qx></section><p class=GehUpe data-test-line-item-price=""><span data-test-integ-cart-current-price="">$');const Pt=S(()=>P(()=>import("./FlexSpace-ZuIl_VRM.js"),__vite__mapDeps([0,1,2]))),Z=S(()=>P(()=>import("./SVG-Bw-dPoFc.js"),__vite__mapDeps([3,1,2,4])));S(()=>P(()=>import("./LoadingColorSpinner-DdRS_GH9.js"),__vite__mapDeps([15,1,2,16])));const wt=S(()=>P(()=>import("./InputHr-DWNR00eQ.js"),__vite__mapDeps([13,1,2,14]))),K=S(()=>P(()=>import("./ButonHrm-DIUBNgu5.js"),__vite__mapDeps([17,1,2,3,4,18])));S(()=>P(()=>import("./ItemOnSalesPos-DwbRgMXO.js"),__vite__mapDeps([19,1,2,4,11,12,20])));const[F,U]=z({items:{}}),k="348723orh2idsffs";function Ht(){T(0),T(0);const[e,r]=T("");lt(()=>{}),st(()=>{}),H(()=>{d()});const d=async()=>{(await Ot())?.map(i=>{U("items",i.doc)})};return(()=>{var u=ht(),i=u.firstChild,l=i.firstChild,c=l.firstChild;return h(c,y(N,{get when(){return I(F?.items?.cart)},get children(){return y(G,{get each(){return I(F?.items?.cart)},children:(b,p)=>y(Et,{get itm(){return F?.items?.cart?.[b]}})})}})),h(i,y(It,{updSearch:r}),null),h(i,y(kt,{get item(){return F?.items?.cart}}),null),u})()}const It=e=>{const[r,d]=T(""),[u,i]=T(1),l=()=>{u()===1&&r().length>8&&c(r())},c=async a=>{let f=D?.profile?.agencyStore?.id,m=`${a}`,o=await M(m),t=I(o)?.[0],n=`${t} ${f}`,_=await Y(n),s=0,g=0;I(_)?.map(C=>{_[C]?.products?.map(x=>{t===x?.product?.id&&(s+=x?.price*1*x?.qty*1,g+=x?.qty*1)})});let v=1,w=await V(k)||{};w?.cart?.[t]&&(v=w?.cart?.[t].qty*1+1);const L=g?s/g:0;if(g&&g-v>=0){let C=w;if(w?.cart||(C.cart={},C._id=k),w?.cart?.[t])C.cart[t].qty=v;else{let x={product:{id:t,label:o?.[t]?.name,code:o?.[t]?.code},qty:v,price:L,salePrice:o?.[t]?.salePrice};C.cart[t]=x}q.put(C,function(W,X){}),U("items",C),d(""),A({text:o?.[t]?.name+" agregado al carrito",timeout:3500,theme:"blue",id:O()})}else A({text:"Sin Existencia",timeout:3500,theme:"red",id:O()})},[b,{refetch:p}]=it(r,async a=>{if(u()===2&&a.length>4){const f=await M(a);let m=[];return I(f).map(o=>{let t=f[o];m.push(t)}),m}else return[]}),$=()=>{d(""),i(1)};return(()=>{var a=gt(),f=a.firstChild,m=f.firstChild,o=m.firstChild,t=o.firstChild,n=t.nextSibling;return h(m,y(N,{get when(){return b()?.length>0},get children(){var _=bt();return h(_,y(G,{get each(){return b()},children:(s,g)=>y(At,{itm:s,clearTx:$})})),_}}),o),h(o,y(wt,{width:"260px",backColor:"#ffffff",borderColor:"#b2b2b2",borderActiveColor:"var(--background-red-ssg)",get value(){return r()},placeholder:"buscar productos ...",colors:"#2b2b2b",handleClick:d,onEnter:l}),t),t.$$click=()=>i(1),h(t,y(Z,{name:"qrcode-scan",size:22,get color(){return u()===1?"#646cff":""}})),n.$$click=()=>i(2),h(n,y(Z,{name:"keyboard",size:22,get color(){return u()===2?"#646cff":""}})),a})()},kt=e=>{const r=i=>{let l=0;return I(e?.item)?.map(c=>{let b=e?.item?.[c];l+=b?.qty*1*b?.salePrice}),l},d=async i=>{let l=new Date,c=O(),b=pt(F?.items?.cart),p=[];I(b).map(_=>{let s={...b[_]};s.qty=s.qty*-1,p.push(s)});let $={type:"SALES",invoice:l.getFullYear()+mt(12),description:"",store:D?.profile?.agencyStore?.id,hbl:"",products:p,ssg_inventory_key:c,ssg_sorder_key:c,createDate:l.getTime(),isCompleted:!0,businessId:D?.profile?.businessYId},a={params:{businessId:D?.profile?.businessYId},form:$},f=j(139003),m={...a,...f},o=j(431005),t={...a,...o};if(await J(m),!(await J(t))?.error){_t(i);let s=await V(k);s.cart=void 0,q.put(s,function(v,w){}),U("items",s)}},u=()=>{let i=O(),l={};l.id=i,l.props={minHeight:"1vh",overlay:!0,height:"93vh",zIndex:450},l.content=y(Dt,{modalId:i,completeOrder:()=>d(i)}),ft(l)};return(()=>{var i=yt(),l=i.firstChild,c=l.firstChild,b=c.firstChild,p=b.firstChild,$=p.nextSibling,a=$.firstChild,f=a.firstChild,m=f.nextSibling;m.firstChild;var o=a.nextSibling,t=o.firstChild,n=t.nextSibling;n.firstChild;var _=o.nextSibling,s=_.firstChild,g=s.nextSibling;g.firstChild;var v=b.nextSibling;return h(m,()=>r().toFixed(2),null),h(n,()=>(r()*.06).toFixed(2),null),h(g,()=>(r()*.06+r()).toFixed(2),null),h(v,y(N,{get when(){return r()>0},get children(){return y(K,{color:"#646cff",label:"Enviar Orden",icon:"outline_cart",handleClick:u})}})),i})()},Et=e=>{const[r,d]=z(),u=()=>r?.[e?.itm?.product?.id]?.productImageUrl?et()+rt()+"/"+r?.[e?.itm?.product?.id]?.productImageUrl:null,i=async()=>{let p=e?.itm?.product?.id,$=`${p}`,a=await M($);a?.[p]?.productImageUrl&&d(p,a?.[p])};H(()=>{i()});let l=Array.from(Array(10).keys());const c=async p=>{let $=D?.profile?.agencyStore?.id,a=e?.itm?.product?.id,f=`${a} ${$}`,m=await Y(f),o=0,t=0;I(m)?.map(_=>{m[_]?.products?.map(s=>{a===s?.product?.id&&(o+=s?.price*1*s?.qty*1,t+=s?.qty*1)})});const n=t?o/t:0;if(t&&t-p>=0){let _=await V(k)||{},s=_;if(_?.cart||(s.cart={},s._id=k),_?.cart?.[a])s.cart[a].qty=p;else{let g={product:{id:a,label:e?.itm?.name,code:e?.itm?.code},qty:p,price:n,salePrice:e?.itm?.salePrice};s.cart[a]=g}q.put(s,function(v,w){}),U("items",s),A({text:" El carrito fue actualizado",timeout:3500,theme:"blue",id:O()})}else A({text:"Sin Existencia",timeout:3500,theme:"red",id:O()})},b=()=>{q.get(k,function($,a){let f={...a};delete f.cart[e?.itm?.product?.id],q.put(f,function(o,t){o||U("items","cart",e?.itm?.product?.id,void 0)})})};return(()=>{var p=$t(),$=p.firstChild,a=$.firstChild,f=a.firstChild,m=f.firstChild,o=m.firstChild,t=m.nextSibling,n=t.firstChild,_=n.firstChild,s=_.firstChild;s.firstChild;var g=n.nextSibling,v=g.firstChild,w=v.firstChild,L=w.nextSibling,C=v.nextSibling,x=C.firstChild;x.firstChild;var W=C.nextSibling,X=W.firstChild,at=X.firstChild;return h(s,()=>e?.itm?.product?.label,null),L.addEventListener("change",B=>{c(B?.target?.value)}),h(L,y(G,{each:l,children:(B,Ut)=>(()=>{var Q=vt();return Q.value=B*1+1+"",h(Q,B*1+1),R(()=>Q.selected=B*1+1===e?.itm?.qty*1),Q})()})),h(x,()=>(e?.itm?.salePrice*1).toFixed(2),null),at.$$click=b,R(()=>tt(o,"src",u())),p})()},M=async(e,r)=>{let d={params:{businessId:D?.profile?.businessYId}};e&&e.split(" ").map((l,c)=>{l&&(d.params[":search"+c]=l.trim())});let u=j(122001);d={...d,...u},d.params[":search0"];const i=await J(d);return i?.error?{}:i},Gt=async e=>{let r=[];e.map(d=>{let u={params:{id:d?.ssg_track_key,idairguide:"all"}},i=j(802002);u={...u,...i},r.push(u)}),dt(r,qt)},qt=async e=>{const d=await ut(e);if(d)return d},Ot=()=>new Promise((e,r)=>{q.allDocs({include_docs:!0,descending:!0},function(d,u){e(u.rows)})});function Dt(e){return(()=>{var r=Ct(),d=r.firstChild,u=d.nextSibling,i=u.nextSibling,l=i.nextSibling;return r.style.setProperty("max-height","80vh"),r.style.setProperty("overflow","auto"),r.style.setProperty("background","#fff"),r.style.setProperty("border-radius","11px"),r.style.setProperty("padding"," 0 21px"),h(l,y(Pt,{}),null),h(l,y(K,{color:"#646cff",icon:"send",label:"Completar Orden",get handleClick(){return e.completeOrder}}),null),R(c=>(c=ot()?"96vw":"420px")!=null?r.style.setProperty("width",c):r.style.removeProperty("width")),r})()}const At=e=>{const[r,d]=z(),u=()=>r?.prod?.productImageUrl?et()+rt()+"/"+r?.prod?.productImageUrl:null;H(()=>{d("prod",e?.itm)}),Array.from(Array(10).keys());const i=async()=>{let l=D?.profile?.agencyStore?.id,c=r?.prod?.ssg_product_key,b=`${c} ${l}`,p=await Y(b),$=0,a=0;I(p)?.map(t=>{p[t]?.products?.map(n=>{c===n?.product?.id&&($+=n?.price*1*n?.qty*1,a+=n?.qty*1)})});let f=1,m=await V(k)||{};m?.cart?.[c]&&(f=m?.cart?.[c].qty+1);const o=a?$/a:0;if(a&&a-f>=0){let t=await V(k)||{},n=t;if(t?.cart||(n.cart={},n._id=k),t?.cart?.[c])n.cart[c].qty=f;else{let _={product:{id:c,label:e?.itm?.name,code:e?.itm?.code},qty:f,price:o,salePrice:e?.itm?.salePrice};n.cart[c]=_}q.put(n,function(s,g){}),U("items",n),e?.clearTx(),A({text:" El carrito fue actualizado",timeout:3500,theme:"blue",id:O()})}else A({text:"Sin Existencia",timeout:3500,theme:"red",id:O()})};return(()=>{var l=St(),c=l.firstChild,b=c.firstChild,p=b.firstChild,$=p.firstChild,a=$.firstChild,f=$.nextSibling,m=f.firstChild,o=m.firstChild,t=o.firstChild;t.firstChild;var n=m.nextSibling,_=n.firstChild,s=_.nextSibling,g=s.firstChild;return g.firstChild,h(t,()=>e?.itm?.name,null),h(_,y(K,{color:"#646cff",label:"Agregar",handleClick:i})),h(g,()=>(e?.itm?.salePrice*1).toFixed(2),null),h(n,y(N,{get when(){return ct()},get children(){return xt()}}),null),R(()=>tt(a,"src",u())),l})()};nt(["click"]);export{M as LookupProducts,F as cartItems,k as cartKey,Ht as default,qt as fetchCSVInve,Ot as loadCarts,Gt as loadProduct,U as setCartItems};
