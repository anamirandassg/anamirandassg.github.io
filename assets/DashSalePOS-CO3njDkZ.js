const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FlexSpace-h0WTAOdc.js","assets/index-CGUrKMLu.js","assets/index-B8bAFC38.css","assets/SVG-CAfbGfq5.js","assets/ShowQRProducts-cZ9gBPfu.js","assets/ShowQRPrintLabel-DTgQ03C9.js","assets/fontkit.es-95peULV2.js","assets/qrcode-DHy8FFhS.js","assets/InitPrintServices-DQBQG4zX.js","assets/Toast-DvUuFSAg.js","assets/Toast-DLpFKn-Q.css","assets/InputHr-CF6qe29D.js","assets/InputHr-BXFw4d2l.css","assets/LoadingColorSpinner-tymsiVXI.js","assets/LoadingColorSpinner-DPNLfwBi.css","assets/ButonHrm-CRhfRgQj.js","assets/ButonHrm-BSeWNUGQ.css","assets/ItemOnSalesPos-DqlyMZQU.js","assets/components-DYebth22.js"])))=>i.map(i=>d[i]);
import{l as w,_ as I,au as D,c as H,a as L,o as it,b as st,d as G,i as h,e as y,O as E,F as Y,S as j,C as ct,n as K,w as J,h as U,j as R,k as M,U as nt,M as ot,z as dt,t as O,p as A,r as ut,q as pt,v as mt}from"./index-CGUrKMLu.js";import{OpenModal as ft,CloseModal as _t}from"./DialogHRM-HsynpYNi.js";import"./browser-image-compression-BVJ4p9S0.js";import{OpenToast as B}from"./Toast-DvUuFSAg.js";import"./fontkit.es-95peULV2.js";import"./qrcode-DHy8FFhS.js";import{g as rt,a as at}from"./handelImagesServices-DqBuo4qc.js";import{LookupInventory as W}from"./DashInventoryMov-DiLUo93M.js";import"./DashInventory-BCMJBNml.js";import"./AddInventory-WM8SEeoA.js";import"./debounces-C1s7JakJ.js";import"./DashProducts-CSAUfUri.js";import"./App.module-CbHnVtRQ.js";import"./FlexSpace-h0WTAOdc.js";w(()=>I(()=>import("./FlexSpace-h0WTAOdc.js"),__vite__mapDeps([0,1,2])));w(()=>I(()=>import("./SVG-CAfbGfq5.js"),__vite__mapDeps([3,1,2])));w(()=>I(()=>import("./ShowQRProducts-cZ9gBPfu.js"),__vite__mapDeps([4,1,2,5,6,7,8,9,10])));w(()=>I(()=>import("./InputHr-CF6qe29D.js"),__vite__mapDeps([11,1,2,12])));const Q=e=>new Promise((r,d)=>{D.get(e,function(s,l){r(l)})});var ht=O('<div style="padding:50px 0"><section class=qsuVSc><section class=bLl6je><section class=dvPdhb>'),gt=O('<section class="h6rxkc ">'),bt=O('<section class=KgyCAd><section class=WirBi><section class=""><section class="EMijzc centerBx"><div class="icon_status centerBx "style="margin:0 4px"></div><div class="icon_status centerBx "style="margin:0 4px">'),yt=O('<section class=rtS8wf><div class=X3QHFf><div class="LhAUHc evth2b"><div class=kDdWge><div class=QCNFEe><p class=jhB0af>Summario de la orden</p></div><div class=qntUl><p class=B7xUP><span data-test-integ-cart-subtotal-label="">Subtotal</span><span data-test-integ-cart-subtotal-value="">$</span></p><p class=B7xUP><span data-test-integ-cart-subtotal-label="">Estimated tax</span><span data-test-integ-cart-subtotal-value="">$</span></p><p class=B7xUP><span data-test-integ-cart-subtotal-label=""class=OGw7rb>Estimated total</span><span data-test-integ-cart-subtotal-value=""class=OGw7rb> $</span></p></div></div><section class=JM2zDb>'),$t=O('<section class=kGEQJf><section class=Z722Ge><section class=VcJUVb><section class=h7Oog><span class=YdB1ac><img class=bwpkad alt=sf></span><section class=pFJUxe><section class=wDj5sf><span data-line-number=1><span class=XNnpOb href=#> </span></span></section><section class=DHk3Fe><section class=Jm2qx><span aria-hidden=true>Qty:</span><select class=RIw0b aria-label="Product Quantity"></select></section><p class=GehUpe data-test-line-item-price=""><span data-test-integ-cart-current-price="">$</span></p><section class=dEfaq><section class=JpKBkb><button class=yjHiqb><span>Remover'),vt=O("<option selected>"),Ct=O("<option>"),xt=O('<div><div class=QCNFEe><p class=jhB0af>Confirmar Orden</p></div><p class=B7xUP><span data-test-integ-cart-subtotal-label="">Desea completar la orden y actualizar el inventario</span></p><div class=separator></div><div style=margin:15px class=" spaceAround centerBx">'),St=O('<section class=kGEQJf><section class=Z722Ge><section class=VcJUVb><section class=h7Oog><span class=YdB1ac><img class=bwpkad alt=sf></span><section class=pFJUxe><section class=wDj5sf><span data-line-number=1><span class=XNnpOb href=#> </span></span></section><section class=DHk3Fe><section class=Jm2qx></section><p class=GehUpe data-test-line-item-price=""><span data-test-integ-cart-current-price="">$</span></p><section class=dEfaq><section class=JpKBkb><button class=yjHiqb jsaction=click:IY6UFe data-line-number=1 data-test-remove-btn=1 aria-label="Remove Nest Doorbell (wired, 2nd gen) (Snow) from cart"><span>Remove');const Pt=w(()=>I(()=>import("./FlexSpace-h0WTAOdc.js"),__vite__mapDeps([0,1,2]))),et=w(()=>I(()=>import("./SVG-CAfbGfq5.js"),__vite__mapDeps([3,1,2])));w(()=>I(()=>import("./LoadingColorSpinner-tymsiVXI.js"),__vite__mapDeps([13,1,2,14])));const wt=w(()=>I(()=>import("./InputHr-CF6qe29D.js"),__vite__mapDeps([11,1,2,12]))),X=w(()=>I(()=>import("./ButonHrm-CRhfRgQj.js"),__vite__mapDeps([15,1,2,3,16])));w(()=>I(()=>import("./ItemOnSalesPos-DqlyMZQU.js"),__vite__mapDeps([17,1,2,9,10,18])));const[V,F]=H({items:{}}),q="348723orh2idsffs";function Gt(){L(0),L(0);const[e,r]=L("");it(()=>{}),st(()=>{}),G(()=>{d()});const d=async()=>{(await Ot())?.map(s=>{F("items",s.doc)})};return(()=>{var u=ht(),s=u.firstChild,l=s.firstChild,c=l.firstChild;return h(c,y(j,{get when(){return E(V?.items?.cart)},get children(){return y(Y,{get each(){return E(V?.items?.cart)},children:(g,p)=>y(Et,{get itm(){return V?.items?.cart?.[g]}})})}})),h(s,y(It,{updSearch:r}),null),h(s,y(kt,{get item(){return V?.items?.cart}}),null),u})()}const It=e=>{const[r,d]=L(""),[u,s]=L(1),l=()=>{u()===1&&r().length>8&&c(r())},c=async a=>{let f=U?.profile?.agencyStore?.id,m=`${a}`,n=await N(m),t=E(n)?.[0],o=`${t} ${f}`,_=await W(o),i=0,b=0;E(_)?.map(x=>{_[x]?.products?.map(S=>{t===S?.product?.id&&(i+=S?.price*1*S?.qty*1,b+=S?.qty*1)})});let C=1,k=await Q(q)||{};k?.cart?.[t]&&(C=k?.cart?.[t].qty*1+1);const T=b?i/b:0;if(b&&b-C>=0){let x=k;if(k?.cart||(x.cart={},x._id=q),k?.cart?.[t])x.cart[t].qty=C;else{let S={product:{id:t,label:n?.[t]?.name,code:n?.[t]?.code},qty:C,price:T,salePrice:n?.[t]?.salePrice};x.cart[t]=S}D.put(x,function(Z,tt){}),F("items",x),d(""),B({text:n?.[t]?.name+" agregado al carrito",timeout:3500,theme:"blue",id:A()})}else B({text:"Sin Existencia",timeout:3500,theme:"red",id:A()})},[g,{refetch:p}]=ct(r,async a=>{if(u()===2&&a.length>4){const f=await N(a);let m=[];return E(f).map(n=>{let t=f[n];m.push(t)}),m}else return[]}),$=()=>{d(""),s(1)};return(()=>{var a=bt(),f=a.firstChild,m=f.firstChild,n=m.firstChild,t=n.firstChild,o=t.nextSibling;return h(m,y(j,{get when(){return g()?.length>0},get children(){var _=gt();return h(_,y(Y,{get each(){return g()},children:(i,b)=>y(At,{itm:i,clearTx:$})})),_}}),n),h(n,y(wt,{width:"260px",backColor:"#ffffff",borderColor:"#b2b2b2",borderActiveColor:"var(--background-red-ssg)",get value(){return r()},placeholder:"buscar productos ...",colors:"#2b2b2b",handleClick:d,onEnter:l}),t),t.$$click=()=>s(1),h(t,y(et,{name:"qrcode-scan",size:22,get color(){return u()===1?"#646cff":""}})),o.$$click=()=>s(2),h(o,y(et,{name:"keyboard",size:22,get color(){return u()===2?"#646cff":""}})),a})()},kt=e=>{const r=s=>{let l=0;return E(e?.item)?.map(c=>{let g=e?.item?.[c];l+=g?.qty*1*g?.salePrice}),l},d=async s=>{let l=new Date,c=A(),g=pt(V?.items?.cart),p=[];E(g).map(_=>{let i={...g[_]};i.qty=i.qty*-1,p.push(i)});let $={type:"SALES",invoice:l.getFullYear()+mt(12),description:"",store:U?.profile?.agencyStore?.id,hbl:"",products:p,ssg_inventory_key:c,ssg_sorder_key:c,createDate:l.getTime(),isCompleted:!0,businessId:U?.profile?.businessYId},a={params:{businessId:U?.profile?.businessYId},form:$},f=R(139003),m={...a,...f},n=R(431005),t={...a,...n};if(await M(m),!(await M(t))?.error){_t(s);let i=await Q(q);i.cart=void 0,D.put(i,function(C,k){}),F("items",i)}},u=()=>{let s=A(),l={};l.id=s,l.props={minHeight:"1vh",overlay:!0,height:"93vh",zIndex:450},l.content=y(Dt,{modalId:s,completeOrder:()=>d(s)}),ft(l)};return(()=>{var s=yt(),l=s.firstChild,c=l.firstChild,g=c.firstChild,p=g.firstChild,$=p.nextSibling,a=$.firstChild,f=a.firstChild,m=f.nextSibling;m.firstChild;var n=a.nextSibling,t=n.firstChild,o=t.nextSibling;o.firstChild;var _=n.nextSibling,i=_.firstChild,b=i.nextSibling;b.firstChild;var C=g.nextSibling;return h(m,()=>r().toFixed(2),null),h(o,()=>(r()*.06).toFixed(2),null),h(b,()=>(r()*.06+r()).toFixed(2),null),h(C,y(j,{get when(){return r()>0},get children(){return y(X,{color:"#646cff",label:"Enviar Orden",icon:"outline_cart",handleClick:u})}})),s})()},Et=e=>{const[r,d]=H(),u=()=>r?.[e?.itm?.product?.id]?.productImageUrl?rt()+at()+"/"+r?.[e?.itm?.product?.id]?.productImageUrl:null,s=async()=>{let p=e?.itm?.product?.id,$=`${p}`,a=await N($);a?.[p]?.productImageUrl&&d(p,a?.[p])};G(()=>{s()});let l=Array.from(Array(10).keys());const c=async p=>{let $=U?.profile?.agencyStore?.id,a=e?.itm?.product?.id,f=`${a} ${$}`,m=await W(f),n=0,t=0;E(m)?.map(_=>{m[_]?.products?.map(i=>{a===i?.product?.id&&(n+=i?.price*1*i?.qty*1,t+=i?.qty*1)})});const o=t?n/t:0;if(t&&t-p>=0){let _=await Q(q)||{},i=_;if(_?.cart||(i.cart={},i._id=q),_?.cart?.[a])i.cart[a].qty=p;else{let b={product:{id:a,label:e?.itm?.name,code:e?.itm?.code},qty:p,price:o,salePrice:e?.itm?.salePrice};i.cart[a]=b}D.put(i,function(C,k){}),F("items",i),B({text:" El carrito fue actualizado",timeout:3500,theme:"blue",id:A()})}else console.log(e?.itm?.qty),B({text:"Sin Existencia",timeout:3500,theme:"red",id:A()})},g=()=>{D.get(q,function($,a){let f={...a};delete f.cart[e?.itm?.product?.id],D.put(f,function(n,t){n||F("items","cart",e?.itm?.product?.id,void 0)})})};return(()=>{var p=$t(),$=p.firstChild,a=$.firstChild,f=a.firstChild,m=f.firstChild,n=m.firstChild,t=m.nextSibling,o=t.firstChild,_=o.firstChild,i=_.firstChild;i.firstChild;var b=o.nextSibling,C=b.firstChild,k=C.firstChild,T=k.nextSibling,x=C.nextSibling,S=x.firstChild;S.firstChild;var Z=x.nextSibling,tt=Z.firstChild,lt=tt.firstChild;return h(i,()=>e?.itm?.product?.label,null),T.addEventListener("change",v=>{c(v?.target?.value)}),h(T,y(Y,{each:l,children:(v,z)=>y(j,{get when(){return v*1+1===e?.itm?.qty*1},get fallback(){return(()=>{var P=Ct();return P.value=v*1+1+"",h(P,v*1+1),P})()},get children(){var P=vt();return P.value=v*1+1+"",h(P,v*1+1),P}})})),h(S,()=>(e?.itm?.salePrice*1).toFixed(2),null),lt.$$click=g,K(v=>{var z=u(),P=e?.itm?.qty;return z!==v.e&&J(n,"src",v.e=z),P!==v.t&&J(T,"aria-value",v.t=P),v},{e:void 0,t:void 0}),p})()},N=async(e,r)=>{let d={params:{businessId:U?.profile?.businessYId}};e&&e.split(" ").map((l,c)=>{l&&(d.params[":search"+c]=l.trim())});let u=R(122001);d={...d,...u},d.params[":search0"];const s=await M(d);return s?.error?{}:s},Yt=async e=>{let r=[];e.map(d=>{let u={params:{id:d?.ssg_track_key,idairguide:"all"}},s=R(802002);u={...u,...s},r.push(u)}),nt(r,qt)},qt=async e=>{const d=await ot(e);if(d)return d},Ot=()=>new Promise((e,r)=>{D.allDocs({include_docs:!0,descending:!0},function(d,u){e(u.rows)})});function Dt(e){return(()=>{var r=xt(),d=r.firstChild,u=d.nextSibling,s=u.nextSibling,l=s.nextSibling;return r.style.setProperty("max-height","80vh"),r.style.setProperty("overflow","auto"),r.style.setProperty("background","#fff"),r.style.setProperty("border-radius","11px"),r.style.setProperty("padding"," 0 21px"),h(l,y(Pt,{}),null),h(l,y(X,{color:"#646cff",icon:"send",label:"Completar Orden",get handleClick(){return e.completeOrder}}),null),K(c=>(c=ut()?"96vw":"420px")!=null?r.style.setProperty("width",c):r.style.removeProperty("width")),r})()}const At=e=>{const[r,d]=H(),u=()=>r?.prod?.productImageUrl?rt()+at()+"/"+r?.prod?.productImageUrl:null;G(()=>{d("prod",e?.itm)}),Array.from(Array(10).keys());const s=async()=>{let l=U?.profile?.agencyStore?.id,c=r?.prod?.ssg_product_key,g=`${c} ${l}`,p=await W(g),$=0,a=0;E(p)?.map(t=>{p[t]?.products?.map(o=>{c===o?.product?.id&&($+=o?.price*1*o?.qty*1,a+=o?.qty*1)})});let f=1,m=await Q(q)||{};m?.cart?.[c]&&(f=m?.cart?.[c].qty+1);const n=a?$/a:0;if(a&&a-f>=0){let t=await Q(q)||{},o=t;if(t?.cart||(o.cart={},o._id=q),t?.cart?.[c])o.cart[c].qty=f;else{let _={product:{id:c,label:e?.itm?.name,code:e?.itm?.code},qty:f,price:n,salePrice:e?.itm?.salePrice};o.cart[c]=_}D.put(o,function(i,b){}),F("items",o),e?.clearTx(),B({text:" El carrito fue actualizado",timeout:3500,theme:"blue",id:A()})}else B({text:"Sin Existencia",timeout:3500,theme:"red",id:A()})};return(()=>{var l=St(),c=l.firstChild,g=c.firstChild,p=g.firstChild,$=p.firstChild,a=$.firstChild,f=$.nextSibling,m=f.firstChild,n=m.firstChild,t=n.firstChild;t.firstChild;var o=m.nextSibling,_=o.firstChild,i=_.nextSibling,b=i.firstChild;return b.firstChild,h(t,()=>e?.itm?.name,null),h(_,y(X,{color:"#646cff",label:"Agregar",handleClick:s})),h(b,()=>(e?.itm?.salePrice*1).toFixed(2),null),K(()=>J(a,"src",u())),l})()};dt(["click"]);export{N as LookupProducts,V as cartItems,q as cartKey,Gt as default,qt as fetchCSVInve,Ot as loadCarts,Yt as loadProduct,F as setCartItems};
